import{b as L,c as W,f as P,i as N,j as B,k as O,m as A}from"./chunk-5TRB5RNR.js";import{a as z}from"./chunk-IL2UONYL.js";import{b as _,c as T}from"./chunk-C5J56EWV.js";import{$a as n,Ka as a,La as v,Va as h,Ya as u,ab as r,bb as F,cc as I,dc as R,e as j,eb as S,fa as w,fb as g,gb as b,gc as V,mb as l,oa as x,ob as M,pa as k,qb as D,rb as d,sb as c,tb as m,vb as E}from"./chunk-RI4DZ32I.js";var C=j(z());function G(o,y){if(o&1){let t=S();n(0,"li",17),g("click",function(){let e=x(t).$implicit,s=b(2);return k(s.seleccionarCliente(e))}),l(1),r()}if(o&2){let t=y.$implicit;a(),D(" ",t.first_name," ",t.last_name," - ",t.ci," ")}}function H(o,y){if(o&1&&(n(0,"ul",15),h(1,G,2,3,"li",16),r()),o&2){let t=b();a(),u("ngForOf",t.clientesFiltrados)}}var Z=(()=>{class o{constructor(t){this.http=t,this.fechaInicio=null,this.fechaFin=null,this.clienteId=null,this.filtroCliente="",this.clientesFiltrados=[],this.timeout=null,this.formato="pdf",this.isLoading=!1}ngOnInit(){}buscarClientePorTexto(){if(clearTimeout(this.timeout),!this.filtroCliente.trim()){this.clientesFiltrados=[];return}this.timeout=setTimeout(()=>{this.http.get("http://137.184.94.190/api/usuarios/",{params:new _().set("busqueda",this.filtroCliente)}).subscribe({next:t=>this.clientesFiltrados=t,error:t=>{console.error("Error al buscar clientes:",t),C.default.fire("Error","No se pudieron buscar clientes.","error")}})},400)}seleccionarCliente(t){this.clienteId=t.id,this.filtroCliente=`${t.first_name} ${t.last_name} - ${t.ci}`,this.clientesFiltrados=[]}generarReporte(){let t=new _().set("fecha_inicio",this.fechaInicio||"").set("fecha_fin",this.fechaFin||"").set("cliente",this.clienteId?.toString()||"");console.log("\u{1F50D} Par\xE1metros enviados:",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,cliente:this.clienteId});let p=this.formato==="pdf"?"http://137.184.94.190/api/reportes/ventas-por-fecha/pdf/":"http://137.184.94.190/api/reportes/ventas-por-fecha/excel/";this.isLoading=!0,this.http.get(p,{params:t,responseType:"blob"}).subscribe({next:e=>{let s=new Blob([e],{type:this.formato==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(s),f=document.createElement("a");f.href=i,f.download=this.formato==="pdf"?"reporte.pdf":"reporte.xlsx",f.click(),this.isLoading=!1},error:e=>{this.isLoading=!1,C.default.fire("Error","No se pudo generar el reporte.","error"),console.error(e)}})}static{this.\u0275fac=function(p){return new(p||o)(v(T))}}static{this.\u0275cmp=w({type:o,selectors:[["app-reportes-ventas"]],standalone:!0,features:[E],decls:29,vars:7,consts:[[1,"min-h-screen","bg-gradient-to-br","from-gray-100","via-white","to-purple-100","dark:from-gray-900","dark:via-gray-800","dark:to-purple-950","p-6","text-gray-900","dark:text-white"],[1,"container","mx-auto"],[1,"text-3xl","font-bold","mb-6","flex","items-center","gap-2"],["src","https://img.icons8.com/color/48/000000/combo-chart--v1.png",1,"w-8","h-8"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6","relative"],[1,"block","font-semibold","mb-1"],["type","date",1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],[1,"relative"],["placeholder","Buscar por nombre o CI","type","text",1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","input","ngModel"],["class","absolute left-0 w-full z-50 bg-white dark:bg-gray-800 rounded-xl shadow-lg mt-1 max-h-60 overflow-y-auto border border-gray-300 dark:border-gray-600 ring-1 ring-purple-300 dark:ring-purple-600 backdrop-blur-sm",4,"ngIf"],[1,"mb-6"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],["value","pdf"],["value","excel"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-3","rounded-lg","shadow","font-bold","transition",3,"click","disabled"],[1,"absolute","left-0","w-full","z-50","bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","mt-1","max-h-60","overflow-y-auto","border","border-gray-300","dark:border-gray-600","ring-1","ring-purple-300","dark:ring-purple-600","backdrop-blur-sm"],["class","px-4 py-2 hover:bg-purple-100 dark:hover:bg-purple-700 cursor-pointer transition-all duration-200",3,"click",4,"ngFor","ngForOf"],[1,"px-4","py-2","hover:bg-purple-100","dark:hover:bg-purple-700","cursor-pointer","transition-all","duration-200",3,"click"]],template:function(p,e){p&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),F(3,"img",3),l(4," Reporte de Ventas "),r(),n(5,"div",4)(6,"div")(7,"label",5),l(8,"\u{1F4C5} Fecha Inicio"),r(),n(9,"input",6),m("ngModelChange",function(i){return c(e.fechaInicio,i)||(e.fechaInicio=i),i}),r()(),n(10,"div")(11,"label",5),l(12,"\u{1F4C5} Fecha Fin"),r(),n(13,"input",6),m("ngModelChange",function(i){return c(e.fechaFin,i)||(e.fechaFin=i),i}),r()(),n(14,"div",7)(15,"label",5),l(16,"\u{1F64B} Cliente (opcional)"),r(),n(17,"input",8),m("ngModelChange",function(i){return c(e.filtroCliente,i)||(e.filtroCliente=i),i}),g("input",function(){return e.buscarClientePorTexto()}),r(),h(18,H,2,1,"ul",9),r()(),n(19,"div",10)(20,"label",5),l(21,"\u{1F4C2} Formato"),r(),n(22,"select",11),m("ngModelChange",function(i){return c(e.formato,i)||(e.formato=i),i}),n(23,"option",12),l(24,"\u{1F4C4} PDF"),r(),n(25,"option",13),l(26,"\u{1F4CA} Excel"),r()()(),n(27,"button",14),g("click",function(){return e.generarReporte()}),l(28),r()()()),p&2&&(a(9),d("ngModel",e.fechaInicio),a(4),d("ngModel",e.fechaFin),a(4),d("ngModel",e.filtroCliente),a(),u("ngIf",e.clientesFiltrados.length),a(4),d("ngModel",e.formato),a(5),u("disabled",e.isLoading),a(),M(" \u2699\uFE0F ",e.isLoading?"Generando...":"Generar Reporte"," "))},dependencies:[V,I,R,A,B,O,L,N,W,P]})}}return o})();export{Z as ReportesVentasComponent};
