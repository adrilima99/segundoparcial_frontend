import{a as H,b as N,c as G,f as R,m as Q}from"./chunk-5TRB5RNR.js";import{a as q}from"./chunk-IL2UONYL.js";import{c as B}from"./chunk-C5J56EWV.js";import{$a as n,Ab as S,Ga as C,Ka as l,La as T,Va as _,Ya as m,a as k,ab as r,bb as f,cc as z,dc as A,e as U,eb as x,fa as I,fb as u,gb as c,gc as W,ib as F,jb as O,kb as L,lb as y,mb as o,nb as E,oa as d,ob as P,pa as p,pb as D,qa as v,ra as V,rb as b,sb as M,tb as w,vb as j}from"./chunk-RI4DZ32I.js";var h=U(q());var $=["fileInput"];function J(a,g){a&1&&(n(0,"div",4),f(1,"div",5),r())}function K(a,g){if(a&1&&f(0,"img",29),a&2){let e=c().$implicit;m("src",e.foto_perfil_url,C)}}function X(a,g){a&1&&(n(0,"span",30),o(1,"Sin logo"),r())}function Y(a,g){if(a&1){let e=x();n(0,"tr",24)(1,"td",17),_(2,K,1,1,"img",25)(3,X,2,0,"ng-template",null,0,S),r(),n(5,"td",17),o(6),r(),n(7,"td",17),o(8),r(),n(9,"td",26)(10,"button",27),u("click",function(){let t=d(e).$implicit,s=c(2);return p(s.editMarca(t))}),o(11," \u270F\uFE0F "),n(12,"span"),o(13,"Editar"),r()(),n(14,"button",28),u("click",function(){let t=d(e).$implicit,s=c(2);return p(s.deleteMarca(t.id))}),o(15," \u{1F5D1}\uFE0F "),n(16,"span"),o(17,"Eliminar"),r()()()()}if(a&2){let e=g.$implicit,i=y(4);l(2),m("ngIf",e.foto_perfil_url)("ngIfElse",i),l(4),E(e.nombre),l(2),E(e.estado?"Activo":"Inactivo")}}function Z(a,g){if(a&1&&f(0,"img",46),a&2){let e=c(3);m("src",e.previewImage,C)}}function ee(a,g){a&1&&(n(0,"div",47),v(),n(1,"svg",48),f(2,"path",49),r()())}function te(a,g){a&1&&(n(0,"div",50),f(1,"div",51),r())}function ie(a,g){if(a&1){let e=x();n(0,"div",31)(1,"div",32)(2,"h2",33),o(3),r(),n(4,"div",34)(5,"div",35),_(6,Z,1,1,"img",36)(7,ee,3,0,"ng-template",null,1,S),n(9,"input",37),u("change",function(t){d(e);let s=c(2);return p(s.onFileSelected(t))}),r()(),n(10,"div")(11,"label",38),o(12,"\u{1F4C1} Nombre"),r(),n(13,"input",39),w("ngModelChange",function(t){d(e);let s=c(2);return M(s.selectedMarca.nombre,t)||(s.selectedMarca.nombre=t),p(t)}),r()(),n(14,"div",40)(15,"input",41),w("ngModelChange",function(t){d(e);let s=c(2);return M(s.selectedMarca.estado,t)||(s.selectedMarca.estado=t),p(t)}),r(),n(16,"label"),o(17,"Activo"),r()(),n(18,"div",42)(19,"button",43),u("click",function(){d(e);let t=c(2);return p(t.saveMarca())}),o(20),r(),n(21,"button",44),u("click",function(){d(e);let t=c(2);return p(t.closeModal())}),o(22," \u274C Cancelar "),r()()(),_(23,te,2,0,"div",45),r()()}if(a&2){let e=y(8),i=c(2);l(3),P(" ",i.isEditMode?"\u270F\uFE0F Editar Marca":"\u2795 Nueva Marca"," "),l(3),m("ngIf",i.previewImage)("ngIfElse",e),l(7),b("ngModel",i.selectedMarca.nombre),l(2),b("ngModel",i.selectedMarca.estado),l(5),P(" ",i.isEditMode?"\u{1F4C2} Actualizar":"\u2705 Guardar"," "),l(3),m("ngIf",i.isSaving)}}function ne(a,g){if(a&1){let e=x();n(0,"div",6)(1,"h1",7),o(2,"Gestionar Marcas"),r(),n(3,"div",8)(4,"div")(5,"button",9),u("click",function(){d(e);let t=c();return p(t.addMarca())}),v(),n(6,"svg",10),f(7,"path",11),r(),o(8," A\xF1adir Marca "),r()(),V(),n(9,"div",12)(10,"input",13),w("ngModelChange",function(t){d(e);let s=c();return M(s.searchTerm,t)||(s.searchTerm=t),p(t)}),u("ngModelChange",function(){d(e);let t=c();return p(t.filterMarcas())}),r()()(),n(11,"div",14)(12,"table",15)(13,"thead")(14,"tr",16)(15,"th",17),o(16,"Logo"),r(),n(17,"th",17),o(18,"Nombre"),r(),n(19,"th",17),o(20,"Estado"),r(),n(21,"th",18),o(22,"Acciones"),r()()(),n(23,"tbody"),_(24,Y,18,4,"tr",19),r()()(),n(25,"div",20)(26,"button",21),u("click",function(){d(e);let t=c();return p(t.prevPage())}),o(27,"Anterior"),r(),n(28,"span",22),o(29),r(),n(30,"button",21),u("click",function(){d(e);let t=c();return p(t.nextPage())}),o(31,"Siguiente"),r()(),_(32,ie,24,7,"div",23),r()}if(a&2){let e=c();l(10),b("ngModel",e.searchTerm),l(14),m("ngForOf",e.paginatedMarcas()),l(2),m("disabled",e.currentPage===1),l(3),D("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),l(),m("disabled",e.currentPage===e.totalPages()),l(2),m("ngIf",e.showModal)}}var de=(()=>{class a{constructor(e){this.http=e,this.marcas=[],this.filteredMarcas=[],this.selectedMarca={id:0,nombre:"",descripcion:null,estado:!0,foto_perfil_url:null},this.selectedFile=null,this.previewImage=null,this.isLoading=!1,this.isSaving=!1,this.showModal=!1,this.isEditMode=!1,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5}ngOnInit(){this.loadMarcas()}loadMarcas(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/marcas/").subscribe({next:e=>{this.marcas=e,this.filteredMarcas=e,this.isLoading=!1},error:e=>{this.isLoading=!1,this.handleHttpError(e)}})}filterMarcas(){let e=this.searchTerm.toLowerCase();this.filteredMarcas=this.marcas.filter(i=>i.nombre.toLowerCase().includes(e)),this.currentPage=1}paginatedMarcas(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredMarcas.slice(e,e+this.itemsPerPage)}totalPages(){return Math.ceil(this.filteredMarcas.length/this.itemsPerPage)}addMarca(){this.selectedMarca={id:0,nombre:"",descripcion:null,estado:!0,foto_perfil_url:null},this.selectedFile=null,this.previewImage=null,this.isEditMode=!1,this.showModal=!0}editMarca(e){this.selectedMarca=k({},e),this.previewImage=e.foto_perfil_url||null,this.selectedFile=null,this.isEditMode=!0,this.showModal=!0}onFileSelected(e){let i=e.target.files[0];if(i){this.selectedFile=i;let t=new FileReader;t.onload=()=>this.previewImage=t.result,t.readAsDataURL(i)}}saveMarca(){let e=new FormData;e.append("nombre",this.selectedMarca.nombre),this.selectedMarca.descripcion&&e.append("descripcion",this.selectedMarca.descripcion),e.append("estado",this.selectedMarca.estado.toString()),this.selectedFile&&e.append("foto_perfil",this.selectedFile);let i=this.isEditMode?`http://137.184.94.190/api/marcas/${this.selectedMarca.id}/`:"http://137.184.94.190/api/marcas/",t=this.isEditMode?this.http.patch(i,e):this.http.post(i,e);this.isSaving=!0,t.subscribe({next:()=>{h.default.fire("\u2705 Guardado",`Marca ${this.isEditMode?"actualizada":"creada"} correctamente.`,"success"),this.loadMarcas(),this.showModal=!1,this.isSaving=!1},error:s=>{this.isSaving=!1,this.handleHttpError(s)}})}deleteMarca(e){h.default.fire({title:"\xBFEliminar marca?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar"}).then(i=>{i.isConfirmed&&this.http.delete(`http://137.184.94.190/api/marcas/${e}/`).subscribe({next:()=>{h.default.fire("\u{1F5D1}\uFE0F Eliminado","La marca fue eliminada.","success"),this.loadMarcas()},error:t=>this.handleHttpError(t)})})}closeModal(){this.showModal=!1,this.previewImage=null,this.selectedFile=null}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}handleHttpError(e){console.error("HTTP Error:",e),h.default.fire("\u274C Error","Ocurri\xF3 un error en el servidor.","error")}static{this.\u0275fac=function(i){return new(i||a)(T(B))}}static{this.\u0275cmp=I({type:a,selectors:[["app-marcas"]],viewQuery:function(i,t){if(i&1&&F($,5),i&2){let s;O(s=L())&&(t.fileInput=s.first)}},standalone:!0,features:[j],decls:2,vars:2,consts:[["noLogo",""],["noPreview",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","justify-between","items-center","mb-6","flex-wrap","sm:flex-nowrap","gap-4"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"w-full","sm:w-auto","sm:ml-auto"],["type","text","placeholder","Buscar por nombre...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white","text-left"],[1,"p-3"],[1,"p-3","text-center"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],["alt","Logo","class","w-10 h-10 rounded object-cover border",3,"src",4,"ngIf","ngIfElse"],[1,"p-3","text-center","space-x-4"],["title","Editar",1,"text-blue-500","hover:text-blue-700","transition","flex","items-center","gap-1",3,"click"],["title","Eliminar",1,"text-red-500","hover:text-red-700","transition","flex","items-center","gap-1",3,"click"],["alt","Logo",1,"w-10","h-10","rounded","object-cover","border",3,"src"],[1,"text-gray-400","text-xs","italic"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","text-black","w-full","max-w-lg","p-8","rounded-xl","shadow-xl","relative"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"flex","flex-col","items-center","gap-2"],["class","w-24 h-24 rounded object-cover border-4 border-purple-400 shadow-md",3,"src",4,"ngIf","ngIfElse"],["type","file","accept","image/*",1,"mt-2","w-full","px-3","py-2","rounded-lg","border","border-purple-300","bg-white","text-black","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"change"],[1,"block","font-bold","mb-1"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"mt-4","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 rounded-xl",4,"ngIf"],[1,"w-24","h-24","rounded","object-cover","border-4","border-purple-400","shadow-md",3,"src"],[1,"w-24","h-24","bg-gray-200","rounded","flex","items-center","justify-center","text-purple-500"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-10","w-10"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.657 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(i,t){i&1&&_(0,J,2,0,"div",2)(1,ne,33,7,"div",3),i&2&&(m("ngIf",t.isLoading),l(),m("ngIf",!t.isLoading))},dependencies:[W,z,A,Q,N,H,G,R],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}input[type=text][_ngcontent-%COMP%], input[type=file][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return a})();export{de as MarcasComponent};
