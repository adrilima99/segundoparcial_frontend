import{b as N,c as H,f as W,m as z}from"./chunk-5TRB5RNR.js";import{a as G}from"./chunk-IL2UONYL.js";import{c as A}from"./chunk-C5J56EWV.js";import{$a as r,Ab as j,Ka as l,La as k,Va as _,Ya as p,a as P,ab as o,bb as f,cb as O,cc as D,db as T,dc as $,e as B,eb as x,fa as E,fb as u,gb as a,gc as L,lb as V,mb as s,nb as y,oa as m,ob as h,pa as g,pb as I,qa as S,ra as M,rb as C,sb as w,tb as R,vb as F}from"./chunk-RI4DZ32I.js";var b=B(G());function q(n,d){n&1&&(r(0,"div",3),f(1,"div",4),o())}function J(n,d){n&1&&(r(0,"span"),s(1,", "),o())}function K(n,d){if(n&1&&(r(0,"span"),s(1),_(2,J,2,0,"span",31),o()),n&2){let e=d.$implicit,i=d.index,t=a(2).$implicit,c=a(2);l(),h(" ",c.getNombrePermiso(e),""),l(),p("ngIf",i<t.permissions.slice(0,3).length-1)}}function Q(n,d){if(n&1&&(r(0,"span",32),s(1),o()),n&2){let e=a(2).$implicit;l(),h("y ",e.permissions.length-3," m\xE1s...")}}function U(n,d){if(n&1&&(O(0),_(1,K,3,2,"span",29)(2,Q,2,1,"span",30),T()),n&2){let e=a().$implicit;l(),p("ngForOf",e.permissions.slice(0,3)),l(),p("ngIf",e.permissions.length>3)}}function X(n,d){n&1&&(r(0,"span",33),s(1,"Sin permisos asignados"),o())}function Y(n,d){if(n&1){let e=x();r(0,"tr",23)(1,"td",24),s(2),o(),r(3,"td",25),_(4,U,3,2,"ng-container",26)(5,X,2,0,"ng-template",null,0,j),o(),r(7,"td",27)(8,"button",28),u("click",function(){let t=m(e).$implicit,c=a(2);return g(c.editRol(t))}),s(9," \u270F\uFE0F "),r(10,"span"),s(11,"Editar"),o()()()()}if(n&2){let e=d.$implicit,i=V(6);l(2),y(e.name),l(2),p("ngIf",e.permissions&&e.permissions.length>0)("ngIfElse",i)}}function Z(n,d){if(n&1){let e=x();r(0,"div",46)(1,"input",47),u("change",function(){let t=m(e).$implicit,c=a(3);return g(c.togglePermiso(t.id))}),o(),r(2,"label",48),s(3),o()()}if(n&2){let e=d.$implicit,i=a(3);l(),p("checked",i.permisoSeleccionado(e.id)),l(2),y(e.name)}}function ee(n,d){n&1&&(r(0,"div",49),f(1,"div",50),o())}function te(n,d){if(n&1){let e=x();r(0,"div",34)(1,"div",35)(2,"h2",36),s(3),o(),r(4,"div",37)(5,"label",38),s(6,"\u{1F3AD} Nombre del Rol"),o(),r(7,"input",39),R("ngModelChange",function(t){m(e);let c=a(2);return w(c.selectedRol.name,t)||(c.selectedRol.name=t),g(t)}),o(),r(8,"label",38),s(9,"\u{1F510} Permisos Asociados"),o(),r(10,"div",40),_(11,Z,4,2,"div",41),o()(),r(12,"div",42)(13,"button",43),u("click",function(){m(e);let t=a(2);return g(t.saveRol())}),s(14," \u2705 Guardar "),o(),r(15,"button",44),u("click",function(){m(e);let t=a(2);return g(t.closeModal())}),s(16," \u274C Cancelar "),o()(),_(17,ee,2,0,"div",45),o()()}if(n&2){let e=a(2);l(3),h(" ",e.selectedRol.id?"\u270F\uFE0F Editar Rol":"\u2795 A\xF1adir Rol"," "),l(4),C("ngModel",e.selectedRol.name),l(4),p("ngForOf",e.permisosDisponibles),l(6),p("ngIf",e.isSaving)}}function ie(n,d){if(n&1){let e=x();r(0,"div",5)(1,"h1",6),s(2,"Gestionar Roles"),o(),r(3,"div",7)(4,"div",8)(5,"button",9),u("click",function(){m(e);let t=a();return g(t.addRol())}),S(),r(6,"svg",10),f(7,"path",11),o(),s(8," A\xF1adir Rol "),o()(),M(),r(9,"div",12)(10,"input",13),R("ngModelChange",function(t){m(e);let c=a();return w(c.searchTerm,t)||(c.searchTerm=t),g(t)}),u("ngModelChange",function(){m(e);let t=a();return g(t.filterRoles())}),o()()(),r(11,"div",14)(12,"table",15)(13,"thead",16)(14,"tr")(15,"th",17),s(16,"Nombre"),o(),r(17,"th",17),s(18,"Permisos"),o(),r(19,"th",17),s(20,"Acciones"),o()()(),r(21,"tbody"),_(22,Y,12,3,"tr",18),o()()(),r(23,"div",19)(24,"button",20),u("click",function(){m(e);let t=a();return g(t.prevPage())}),s(25,"Anterior"),o(),r(26,"span",21),s(27),o(),r(28,"button",20),u("click",function(){m(e);let t=a();return g(t.nextPage())}),s(29,"Siguiente"),o()(),_(30,te,18,4,"div",22),o()}if(n&2){let e=a();l(10),C("ngModel",e.searchTerm),l(12),p("ngForOf",e.paginatedRoles()),l(2),p("disabled",e.currentPage===1),l(3),I("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),l(),p("disabled",e.currentPage===e.totalPages()),l(2),p("ngIf",e.showModal)}}var ce=(()=>{class n{constructor(e){this.http=e,this.roles=[],this.filteredRoles=[],this.permisosDisponibles=[],this.selectedRol=this.getEmptyRol(),this.showModal=!1,this.isLoading=!1,this.isSaving=!1,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5}ngOnInit(){this.loadRoles(),this.loadPermisos()}getEmptyRol(){return{id:0,name:"",permissions:[]}}loadRoles(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/roles/").subscribe({next:e=>{this.roles=e,this.filterRoles(),this.isLoading=!1},error:e=>{this.isLoading=!1,this.handleHttpError(e)}})}loadPermisos(){this.http.get("http://137.184.94.190/api/permisos/").subscribe({next:e=>this.permisosDisponibles=e,error:e=>this.handleHttpError(e)})}filterRoles(){let e=this.searchTerm.toLowerCase();this.filteredRoles=this.roles.filter(i=>i.name.toLowerCase().includes(e)),this.currentPage=1}paginatedRoles(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredRoles.slice(e,e+this.itemsPerPage)}totalPages(){return Math.ceil(this.filteredRoles.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}addRol(){this.selectedRol=this.getEmptyRol(),this.showModal=!0}editRol(e){this.selectedRol=P({},e),this.showModal=!0}togglePermiso(e){let i=this.selectedRol.permissions.indexOf(e);i>-1?this.selectedRol.permissions.splice(i,1):this.selectedRol.permissions.push(e)}getNombrePermiso(e){let i=this.permisosDisponibles.find(t=>t.id===e);return i?i.name:`#${e}`}permisoSeleccionado(e){return this.selectedRol.permissions.includes(e)}closeModal(){this.showModal=!1,this.selectedRol=this.getEmptyRol()}saveRol(){let e="http://137.184.94.190/api/roles/",i={name:this.selectedRol.name,permissions:this.selectedRol.permissions},t=this.selectedRol.id?this.http.put(`${e}${this.selectedRol.id}/`,i):this.http.post(e,i);this.isSaving=!0,t.subscribe({next:()=>{b.default.fire("Guardado","Rol actualizado correctamente.","success"),this.loadRoles(),this.closeModal(),this.isSaving=!1},error:c=>{this.isSaving=!1;let v=this.formatErrors(c?.error);b.default.fire("Error al guardar",v,"error")}})}handleHttpError(e){console.error("HTTP Error:",e);let i=this.formatErrors(e?.error);b.default.fire("Error",i,"error")}formatErrors(e){return!e||typeof e!="object"?"Error desconocido":Object.entries(e).map(([i,t])=>Array.isArray(t)?`<strong>${i}:</strong> ${t.join(", ")}`:t&&typeof t=="object"?`<strong>${i}:</strong><br>`+Object.entries(t).map(([c,v])=>`&nbsp;&nbsp;\u2192 ${c}: ${v}`).join("<br>"):`<strong>${i}:</strong> ${JSON.stringify(t)}`).join("<br>")}static{this.\u0275fac=function(i){return new(i||n)(k(A))}}static{this.\u0275cmp=E({type:n,selectors:[["app-roles"]],standalone:!0,features:[F],decls:2,vars:2,consts:[["noPermisos",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4","mb-6"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"w-full","sm:w-auto"],["type","text","placeholder","Buscar rol...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white"],[1,"p-3","text-left"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],[1,"p-3"],[1,"p-3","text-gray-700"],[4,"ngIf","ngIfElse"],[1,"p-3","flex","gap-4"],[1,"flex","items-center","gap-1","text-blue-600","hover:text-blue-800","font-semibold",3,"click"],[4,"ngFor","ngForOf"],["class","text-gray-400",4,"ngIf"],[4,"ngIf"],[1,"text-gray-400"],[1,"italic","text-gray-400"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","w-full","max-w-lg","p-6","rounded-xl","shadow-xl","relative","overflow-y-auto","max-h-[90vh]"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"block","font-bold","mb-1"],["type","text",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],[1,"max-h-40","overflow-y-auto","border","rounded-md","bg-gray-50","p-2"],["class","flex items-center space-x-2 mb-1",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-xl",4,"ngIf"],[1,"flex","items-center","space-x-2","mb-1"],["type","checkbox",1,"accent-purple-600",3,"change","checked"],[1,"text-sm"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(i,t){i&1&&_(0,q,2,0,"div",1)(1,ie,31,7,"div",2),i&2&&(p("ngIf",t.isLoading),l(),p("ngIf",!t.isLoading))},dependencies:[L,D,$,z,N,H,W],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return n})();export{ce as RolesComponent};
