import{a as N,b as H,c as G,f as R,i as Q,j as U,k as q,m as J}from"./chunk-5TRB5RNR.js";import{a as X}from"./chunk-IL2UONYL.js";import{c as A}from"./chunk-C5J56EWV.js";import{$a as n,Ab as P,Ga as E,Ka as s,La as D,Va as _,Ya as u,a as k,ab as r,bb as b,cc as W,dc as B,e as K,eb as v,fa as V,fb as m,gb as c,gc as z,ib as F,jb as T,kb as O,lb as M,mb as a,nb as S,oa as d,ob as C,pa as g,pb as j,qa as y,ra as I,rb as f,sb as x,tb as h,vb as L}from"./chunk-RI4DZ32I.js";var w=K(X());var Y=["fileInput"];function Z(o,p){o&1&&(n(0,"div",4),b(1,"div",5),r())}function $(o,p){if(o&1&&b(0,"img",29),o&2){let e=c().$implicit;u("src",e.foto_perfil_url,E)}}function ee(o,p){o&1&&(n(0,"span",30),a(1,"Sin imagen"),r())}function te(o,p){if(o&1){let e=v();n(0,"tr",24)(1,"td",17),_(2,$,1,1,"img",25)(3,ee,2,0,"ng-template",null,0,P),r(),n(5,"td",17),a(6),r(),n(7,"td",17),a(8),r(),n(9,"td",17),a(10),r(),n(11,"td",17),a(12),r(),n(13,"td",26)(14,"button",27),m("click",function(){let t=d(e).$implicit,l=c(2);return g(l.editSubcategoria(t))}),a(15," \u270F\uFE0F "),n(16,"span"),a(17,"Editar"),r()(),n(18,"button",28),m("click",function(){let t=d(e).$implicit,l=c(2);return g(l.deleteSubcategoria(t.id))}),a(19," \u{1F5D1}\uFE0F "),n(20,"span"),a(21,"Eliminar"),r()()()()}if(o&2){let e=p.$implicit,i=M(4),t=c(2);s(2),u("ngIf",e.foto_perfil_url)("ngIfElse",i),s(4),S(e.nombre),s(2),S(e.descripcion||"\u2014"),s(2),C(" ",t.getCategoriaNombre(e.categoria)," "),s(2),S(e.estado?"Activo":"Inactivo")}}function ie(o,p){if(o&1&&b(0,"img",50),o&2){let e=c(3);u("src",e.previewImage,E)}}function ne(o,p){o&1&&(n(0,"div",51),y(),n(1,"svg",52),b(2,"path",53),r()())}function re(o,p){if(o&1&&(n(0,"option",54),a(1),r()),o&2){let e=p.$implicit;u("ngValue",e.id),s(),S(e.nombre)}}function oe(o,p){o&1&&(n(0,"div",55),b(1,"div",56),r())}function ae(o,p){if(o&1){let e=v();n(0,"div",31)(1,"div",32)(2,"h2",33),a(3),r(),n(4,"div",34)(5,"div",35),_(6,ie,1,1,"img",36)(7,ne,3,0,"ng-template",null,1,P),n(9,"input",37),m("change",function(t){d(e);let l=c(2);return g(l.onFileSelected(t))}),r()(),n(10,"div")(11,"label",38),a(12,"\u{1F4DB} Nombre"),r(),n(13,"input",39),h("ngModelChange",function(t){d(e);let l=c(2);return x(l.selectedSubcategoria.nombre,t)||(l.selectedSubcategoria.nombre=t),g(t)}),r()(),n(14,"div")(15,"label",38),a(16,"\u{1F4DD} Descripci\xF3n"),r(),n(17,"textarea",40),h("ngModelChange",function(t){d(e);let l=c(2);return x(l.selectedSubcategoria.descripcion,t)||(l.selectedSubcategoria.descripcion=t),g(t)}),r()(),n(18,"div")(19,"label",38),a(20,"\u{1F4C2} Categor\xEDa"),r(),n(21,"select",41),h("ngModelChange",function(t){d(e);let l=c(2);return x(l.selectedSubcategoria.categoria,t)||(l.selectedSubcategoria.categoria=t),g(t)}),n(22,"option",42),a(23,"Seleccione una categor\xEDa..."),r(),_(24,re,2,2,"option",43),r()(),n(25,"div",44)(26,"input",45),h("ngModelChange",function(t){d(e);let l=c(2);return x(l.selectedSubcategoria.estado,t)||(l.selectedSubcategoria.estado=t),g(t)}),r(),n(27,"label"),a(28,"Activo"),r()(),n(29,"div",46)(30,"button",47),m("click",function(){d(e);let t=c(2);return g(t.saveSubcategoria())}),a(31),r(),n(32,"button",48),m("click",function(){d(e);let t=c(2);return g(t.closeModal())}),a(33," \u274C Cancelar "),r()()(),_(34,oe,2,0,"div",49),r()()}if(o&2){let e=M(8),i=c(2);s(3),C(" ",i.isEditMode?"\u270F\uFE0F Editar Subcategor\xEDa":"\u2795 Nueva Subcategor\xEDa"," "),s(3),u("ngIf",i.previewImage)("ngIfElse",e),s(7),f("ngModel",i.selectedSubcategoria.nombre),s(4),f("ngModel",i.selectedSubcategoria.descripcion),s(4),f("ngModel",i.selectedSubcategoria.categoria),s(),u("ngValue",null),s(2),u("ngForOf",i.categorias),s(2),f("ngModel",i.selectedSubcategoria.estado),s(5),C(" ",i.isEditMode?"\u{1F4BE} Actualizar":"\u2705 Guardar"," "),s(3),u("ngIf",i.isSaving)}}function le(o,p){if(o&1){let e=v();n(0,"div",6)(1,"h1",7),a(2,"Gestionar Subcategor\xEDas"),r(),n(3,"div",8)(4,"div")(5,"button",9),m("click",function(){d(e);let t=c();return g(t.addSubcategoria())}),y(),n(6,"svg",10),b(7,"path",11),r(),a(8," A\xF1adir Subcategor\xEDa "),r()(),I(),n(9,"div",12)(10,"input",13),h("ngModelChange",function(t){d(e);let l=c();return x(l.searchTerm,t)||(l.searchTerm=t),g(t)}),m("ngModelChange",function(){d(e);let t=c();return g(t.filterSubcategorias())}),r()()(),n(11,"div",14)(12,"table",15)(13,"thead")(14,"tr",16)(15,"th",17),a(16,"Imagen"),r(),n(17,"th",17),a(18,"Nombre"),r(),n(19,"th",17),a(20,"Descripci\xF3n"),r(),n(21,"th",17),a(22,"Categor\xEDa"),r(),n(23,"th",17),a(24,"Estado"),r(),n(25,"th",18),a(26,"Acciones"),r()()(),n(27,"tbody"),_(28,te,22,6,"tr",19),r()()(),n(29,"div",20)(30,"button",21),m("click",function(){d(e);let t=c();return g(t.prevPage())}),a(31,"Anterior"),r(),n(32,"span",22),a(33),r(),n(34,"button",21),m("click",function(){d(e);let t=c();return g(t.nextPage())}),a(35,"Siguiente"),r()(),_(36,ae,35,11,"div",23),r()}if(o&2){let e=c();s(10),f("ngModel",e.searchTerm),s(18),u("ngForOf",e.paginatedSubcategorias()),s(2),u("disabled",e.currentPage===1),s(3),j("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),s(),u("disabled",e.currentPage===e.totalPages()),s(2),u("ngIf",e.showModal)}}var me=(()=>{class o{constructor(e){this.http=e,this.isLoading=!1,this.isSaving=!1,this.categorias=[],this.subcategorias=[],this.filteredSubcategorias=[],this.selectedSubcategoria={id:0,nombre:"",descripcion:null,estado:!0,categoria:null,foto_perfil:null,foto_perfil_url:null},this.selectedFile=null,this.previewImage=null,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5,this.showModal=!1,this.isEditMode=!1}ngOnInit(){this.loadCategorias(),this.loadSubcategorias()}loadCategorias(){this.http.get("http://137.184.94.190/api/categorias/").subscribe({next:e=>this.categorias=e,error:e=>this.handleHttpError(e)})}loadSubcategorias(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/subcategorias/").subscribe({next:e=>{this.subcategorias=e,this.filteredSubcategorias=e,this.isLoading=!1},error:e=>{this.isLoading=!1,this.handleHttpError(e)}})}filterSubcategorias(){this.currentPage=1;let e=this.searchTerm.toLowerCase();this.filteredSubcategorias=this.subcategorias.filter(i=>i.nombre.toLowerCase().includes(e))}paginatedSubcategorias(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredSubcategorias.slice(e,e+this.itemsPerPage)}totalPages(){return Math.ceil(this.filteredSubcategorias.length/this.itemsPerPage)}getCategoriaNombre(e){if(!e)return"Sin categor\xEDa";if(typeof e=="object")return e.nombre;let i=this.categorias.find(t=>t.id===e);return i?i.nombre:"Sin categor\xEDa"}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}addSubcategoria(){this.selectedSubcategoria={id:0,nombre:"",descripcion:null,estado:!0,categoria:null,foto_perfil:null,foto_perfil_url:null},this.previewImage=null,this.selectedFile=null,this.isEditMode=!1,this.showModal=!0}editSubcategoria(e){this.selectedSubcategoria=k({},e),this.previewImage=e.foto_perfil_url||null,this.selectedFile=null,this.isEditMode=!0,this.showModal=!0}onFileSelected(e){let i=e.target.files[0];if(i){this.selectedFile=i;let t=new FileReader;t.onload=()=>this.previewImage=t.result,t.readAsDataURL(i)}}saveSubcategoria(){let e=new FormData;e.append("nombre",this.selectedSubcategoria.nombre),this.selectedSubcategoria.descripcion&&e.append("descripcion",this.selectedSubcategoria.descripcion),e.append("estado",this.selectedSubcategoria.estado.toString()),this.selectedSubcategoria.categoria!==null&&e.append("categoria",this.selectedSubcategoria.categoria.toString()),this.selectedFile&&e.append("foto_perfil",this.selectedFile);let i=this.isEditMode?`http://137.184.94.190/api/subcategorias/${this.selectedSubcategoria.id}/`:"http://137.184.94.190/api/subcategorias/",t=this.isEditMode?this.http.patch(i,e):this.http.post(i,e);this.isSaving=!0,t.subscribe({next:()=>{w.default.fire("Guardado",`Subcategor\xEDa ${this.isEditMode?"actualizada":"creada"} correctamente.`,"success"),this.loadSubcategorias(),this.showModal=!1,this.isSaving=!1},error:l=>{this.isSaving=!1,this.handleHttpError(l)}})}deleteSubcategoria(e){w.default.fire({title:"\xBFEliminar subcategor\xEDa?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar"}).then(i=>{i.isConfirmed&&this.http.delete(`http://137.184.94.190/api/subcategorias/${e}/`).subscribe({next:()=>{w.default.fire("Eliminado","La subcategor\xEDa fue eliminada.","success"),this.loadSubcategorias()},error:t=>this.handleHttpError(t)})})}closeModal(){this.showModal=!1,this.selectedFile=null,this.previewImage=null}handleHttpError(e){console.error("HTTP Error:",e),w.default.fire("Error","Ocurri\xF3 un error en el servidor.","error")}static{this.\u0275fac=function(i){return new(i||o)(D(A))}}static{this.\u0275cmp=V({type:o,selectors:[["app-subcategorias"]],viewQuery:function(i,t){if(i&1&&F(Y,5),i&2){let l;T(l=O())&&(t.fileInput=l.first)}},standalone:!0,features:[L],decls:2,vars:2,consts:[["noFoto",""],["noPreview",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","justify-between","items-center","mb-6","flex-wrap","sm:flex-nowrap","gap-4"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"w-full","sm:w-auto","sm:ml-auto"],["type","text","placeholder","Buscar por nombre...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white","text-left"],[1,"p-3"],[1,"p-3","text-center"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],["alt","Imagen","class","w-10 h-10 rounded object-cover border",3,"src",4,"ngIf","ngIfElse"],[1,"p-3","text-center","space-x-4"],["title","Editar",1,"text-blue-500","hover:text-blue-700","transition","flex","items-center","gap-1",3,"click"],["title","Eliminar",1,"text-red-500","hover:text-red-700","transition","flex","items-center","gap-1",3,"click"],["alt","Imagen",1,"w-10","h-10","rounded","object-cover","border",3,"src"],[1,"text-gray-400","text-xs","italic"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","text-black","w-full","max-w-lg","p-8","rounded-xl","shadow-xl","relative"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"flex","flex-col","items-center","gap-2"],["class","w-24 h-24 rounded object-cover border-4 border-purple-400 shadow-md",3,"src",4,"ngIf","ngIfElse"],["type","file","accept","image/*",1,"mt-2","w-full","px-3","py-2","rounded-lg","border","border-purple-300","bg-white","text-black","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"change"],[1,"block","font-bold","mb-1"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"flex","items-center","gap-2"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"mt-4","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 rounded-xl",4,"ngIf"],[1,"w-24","h-24","rounded","object-cover","border-4","border-purple-400","shadow-md",3,"src"],[1,"w-24","h-24","bg-gray-200","rounded","flex","items-center","justify-center","text-purple-500"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-10","w-10"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.657 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"],[3,"ngValue"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(i,t){i&1&&_(0,Z,2,0,"div",2)(1,le,37,7,"div",3),i&2&&(u("ngIf",t.isLoading),s(),u("ngIf",!t.isLoading))},dependencies:[z,W,B,J,U,q,H,N,Q,G,R],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}input[type=text][_ngcontent-%COMP%], input[type=file][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return o})();export{me as SubcategoriasComponent};
