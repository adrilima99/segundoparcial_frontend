import{b as Q,c as q,f as J,i as K,j as X,k as Y,m as Z}from"./chunk-5TRB5RNR.js";import{a as te}from"./chunk-IL2UONYL.js";import{c as G}from"./chunk-C5J56EWV.js";import{$a as i,Ab as M,Ga as V,Ka as s,La as F,Va as f,Ya as c,a as I,ab as n,bb as v,bc as R,cb as T,cc as N,db as D,dc as z,e as ee,eb as y,fa as P,fb as h,gb as d,gc as H,ib as W,jb as O,kb as A,lb as E,mb as a,nb as w,oa as u,ob as U,pa as p,pb as L,qa as S,ra as k,rb as _,sb as g,tb as x,vb as B,wb as j}from"./chunk-RI4DZ32I.js";var b=ee(te());var ie=["fileInput"],ne=l=>({"border-red-500":l});function re(l,m){l&1&&(i(0,"div",5),v(1,"div",6),n())}function oe(l,m){if(l&1&&v(0,"img",31),l&2){let e=d().$implicit;c("src",e.foto_perfil,V)}}function ae(l,m){l&1&&(S(),i(0,"svg",32),v(1,"path",33),n())}function le(l,m){if(l&1&&(i(0,"span",35),a(1),n()),l&2){let e=m.$implicit;s(),U(" ",e," ")}}function se(l,m){if(l&1&&(T(0),f(1,le,2,1,"span",34),D()),l&2){let e=d().$implicit;s(),c("ngForOf",e.groups)}}function de(l,m){l&1&&(i(0,"span",36),a(1,"No asignado"),n())}function ce(l,m){if(l&1){let e=y();i(0,"tr",25)(1,"td",17),f(2,oe,1,1,"img",26)(3,ae,2,0,"ng-template",null,0,M),n(),i(5,"td",17),a(6),n(),i(7,"td",17),a(8),n(),i(9,"td",17),a(10),n(),i(11,"td",17),a(12),n(),i(13,"td",17),a(14),n(),i(15,"td",17),a(16),n(),i(17,"td",17),a(18),n(),i(19,"td",17),a(20),n(),i(21,"td",17),a(22),n(),i(23,"td",17),f(24,se,2,1,"ng-container",27)(25,de,2,0,"ng-template",null,1,M),n(),i(27,"td",28)(28,"button",29),h("click",function(){let t=u(e).$implicit,o=d(2);return p(o.editUsuario(t))}),a(29," \u270F\uFE0F "),i(30,"span"),a(31,"Editar"),n()(),i(32,"button",30),h("click",function(){let t=u(e).$implicit,o=d(2);return p(o.deleteUsuario(t.id))}),a(33," \u{1F5D1}\uFE0F "),i(34,"span"),a(35,"Eliminar"),n()()()()}if(l&2){let e=m.$implicit,r=E(4),t=E(26),o=d(2);s(2),c("ngIf",e.foto_perfil)("ngIfElse",r),s(4),w(o.getValor(e.username)),s(2),w(o.getValor(e.first_name)),s(2),w(o.getValor(e.last_name)),s(2),w(o.getValor(e.email)),s(2),w(o.getValor(e.ci)),s(2),w(o.getValor(e.celular)),s(2),w(o.getValor(e.direccion)),s(2),w(o.getValor(e.fecha_ingreso)),s(2),w(e.activo?"S\xED":"No"),s(2),c("ngIf",e.groups==null?null:e.groups.length)("ngIfElse",t)}}function ue(l,m){if(l&1&&v(0,"img",55),l&2){let e=d(3);c("src",e.previewImage,V)}}function pe(l,m){l&1&&(i(0,"div",56),S(),i(1,"svg",57),v(2,"path",33),n()())}function me(l,m){if(l&1){let e=y();i(0,"div")(1,"label",45),a(2,"\u{1F512} Contrase\xF1a"),n(),i(3,"input",58),x("ngModelChange",function(t){u(e);let o=d(3);return g(o.password,t)||(o.password=t),p(t)}),n()()}if(l&2){let e=d(3);s(3),_("ngModel",e.password)}}function _e(l,m){l&1&&(i(0,"option",59),a(1,"Administrador"),n()),l&2&&c("ngValue","Administrador")}function ge(l,m){l&1&&(i(0,"option",59),a(1,"Vendedor"),n()),l&2&&c("ngValue","Vendedor")}function xe(l,m){if(l&1){let e=y();i(0,"div",37)(1,"div",38)(2,"h2",39),a(3),n(),i(4,"div",40)(5,"div",41)(6,"div",42),f(7,ue,1,1,"img",43)(8,pe,3,0,"ng-template",null,2,M),i(10,"input",44),h("change",function(t){u(e);let o=d(2);return p(o.onFileSelected(t))}),n()(),i(11,"div")(12,"label",45),a(13,"\u{1F464} Nombre"),n(),i(14,"input",46),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.first_name,t)||(o.selectedUsuario.first_name=t),p(t)}),n()(),i(15,"div")(16,"label",45),a(17,"\u{1F465} Apellido"),n(),i(18,"input",46),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.last_name,t)||(o.selectedUsuario.last_name=t),p(t)}),n()(),i(19,"div")(20,"label",45),a(21,"\u{1FAAA} CI"),n(),i(22,"input",46),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.ci,t)||(o.selectedUsuario.ci=t),p(t)}),n()(),i(23,"div")(24,"label",45),a(25,"\u{1F4F1} Celular"),n(),i(26,"input",46),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.celular,t)||(o.selectedUsuario.celular=t),p(t)}),n()()(),i(27,"div",41)(28,"div")(29,"label",45),a(30,"\u{1F4CD} Direcci\xF3n"),n(),i(31,"input",46),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.direccion,t)||(o.selectedUsuario.direccion=t),p(t)}),n()(),i(32,"div")(33,"label",45),a(34,"\u{1F194} Username"),n(),i(35,"input",46),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.username,t)||(o.selectedUsuario.username=t),p(t)}),n()(),i(36,"div")(37,"label",45),a(38,"\u2709\uFE0F Email"),n(),i(39,"input",47),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.selectedUsuario.email,t)||(o.selectedUsuario.email=t),p(t)}),n()(),f(40,me,4,1,"div",48),i(41,"div")(42,"label",45),a(43,"\u{1F3AD} Rol"),n(),i(44,"select",49),x("ngModelChange",function(t){u(e);let o=d(2);return g(o.rolSeleccionado,t)||(o.rolSeleccionado=t),p(t)}),i(45,"option",50),a(46,"Seleccione un rol..."),n(),f(47,_e,2,1,"option",51)(48,ge,2,1,"option",51),n()()()(),i(49,"div",52)(50,"button",53),h("click",function(){u(e);let t=d(2);return p(t.saveUsuario())}),a(51),n(),i(52,"button",54),h("click",function(){u(e);let t=d(2);return p(t.closeModal())}),a(53," \u274C Cancelar "),n()()()()}if(l&2){let e=E(9),r=d(2);s(3),U(" ",r.isEditMode?"\u270F\uFE0F Editar Usuario":"\u2795 A\xF1adir Usuario"," "),s(4),c("ngIf",r.previewImage)("ngIfElse",e),s(7),_("ngModel",r.selectedUsuario.first_name),s(4),_("ngModel",r.selectedUsuario.last_name),s(4),_("ngModel",r.selectedUsuario.ci),s(4),_("ngModel",r.selectedUsuario.celular),s(5),_("ngModel",r.selectedUsuario.direccion),s(4),_("ngModel",r.selectedUsuario.username),s(4),_("ngModel",r.selectedUsuario.email),s(),c("ngIf",!r.isEditMode),s(4),_("ngModel",r.rolSeleccionado),c("ngClass",j(17,ne,!r.rolSeleccionado)),s(),c("ngValue",null),s(2),c("ngIf",r.isSuperadmin()),s(),c("ngIf",r.isSuperadmin()||r.isAdmin()),s(3),U(" ",r.isEditMode?"\u{1F4BE} Actualizar":"\u2705 Guardar"," ")}}function fe(l,m){l&1&&(i(0,"div",60),v(1,"div",61),n())}function he(l,m){if(l&1){let e=y();i(0,"div",7)(1,"h1",8),a(2,"Gestionar Usuarios"),n(),i(3,"div",9)(4,"button",10),h("click",function(){u(e);let t=d();return p(t.addUsuario())}),S(),i(5,"svg",11),v(6,"path",12),n(),a(7," A\xF1adir Usuario "),n(),k(),i(8,"input",13),x("ngModelChange",function(t){u(e);let o=d();return g(o.searchTerm,t)||(o.searchTerm=t),p(t)}),h("ngModelChange",function(){u(e);let t=d();return p(t.filterUsuarios())}),n()(),i(9,"div",14)(10,"table",15)(11,"thead")(12,"tr",16)(13,"th",17),a(14,"Foto"),n(),i(15,"th",17),a(16,"Username"),n(),i(17,"th",17),a(18,"Nombre"),n(),i(19,"th",17),a(20,"Apellido"),n(),i(21,"th",17),a(22,"Email"),n(),i(23,"th",17),a(24,"CI"),n(),i(25,"th",17),a(26,"Celular"),n(),i(27,"th",17),a(28,"Direcci\xF3n"),n(),i(29,"th",17),a(30,"Fecha Ingreso"),n(),i(31,"th",17),a(32,"Activo"),n(),i(33,"th",17),a(34,"Rol"),n(),i(35,"th",18),a(36,"Acciones"),n()()(),i(37,"tbody"),f(38,ce,36,13,"tr",19),n()()(),i(39,"div",20)(40,"button",21),h("click",function(){u(e);let t=d();return p(t.prevPage())}),a(41,"Anterior"),n(),i(42,"span",22),a(43),n(),i(44,"button",21),h("click",function(){u(e);let t=d();return p(t.nextPage())}),a(45,"Siguiente"),n()(),f(46,xe,54,19,"div",23)(47,fe,2,0,"div",24),n()}if(l&2){let e=d();s(8),_("ngModel",e.searchTerm),s(30),c("ngForOf",e.paginatedUsuarios()),s(2),c("disabled",e.currentPage===1),s(3),L("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),s(),c("disabled",e.currentPage===e.totalPages()),s(2),c("ngIf",e.showModal),s(),c("ngIf",e.isSaving)}}var Ee=(()=>{class l{constructor(e){this.http=e,this.isLoading=!1,this.isSaving=!1,this.usuarios=[],this.filteredUsuarios=[],this.selectedUsuario={id:0,username:"",email:"",first_name:"",last_name:"",ci:"",celular:null,direccion:null,fecha_ingreso:null,activo:!0,groups:null,foto_perfil:null},this.rolSeleccionado=null,this.showModal=!1,this.isEditMode=!1,this.password="",this.selectedFile=null,this.previewImage=null,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5}ngOnInit(){this.loadUsuarios()}loadUsuarios(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/usuarios/").subscribe(e=>{this.usuarios=e,this.filteredUsuarios=e,this.isLoading=!1},e=>{this.isLoading=!1,this.handleHttpError(e)})}filterUsuarios(){this.currentPage=1;let e=this.searchTerm.toLowerCase();this.filteredUsuarios=this.usuarios.filter(r=>r.username.toLowerCase().includes(e)||r.email.toLowerCase().includes(e))}paginatedUsuarios(){let e=(this.currentPage-1)*this.itemsPerPage,r=e+this.itemsPerPage;return this.filteredUsuarios.slice(e,r)}totalPages(){return Math.ceil(this.filteredUsuarios.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}addUsuario(){this.selectedUsuario={id:0,username:"",email:"",first_name:"",last_name:"",ci:"",celular:null,direccion:null,fecha_ingreso:null,activo:!0,groups:null,foto_perfil:null},this.password="",this.rolSeleccionado=null,this.selectedFile=null,this.previewImage=null,this.isEditMode=!1,this.showModal=!0}editUsuario(e){this.selectedUsuario=I({},e),this.rolSeleccionado=e.groups?.[0]||null,this.password="",this.previewImage=e.foto_perfil??null,this.selectedFile=null,this.isEditMode=!0,this.showModal=!0}onFileSelected(e){let r=e.target.files[0];if(r){this.selectedFile=r;let t=new FileReader;t.onload=o=>this.previewImage=t.result,t.readAsDataURL(r)}}isSuperadmin(){return localStorage.getItem("userRole")==="Superadmin"}isAdmin(){return localStorage.getItem("userRole")==="Administrador"}getValor(e){return e!==null&&e!==""?e:"No disponible"}saveUsuario(){if(!this.rolSeleccionado){b.default.fire("Rol requerido","Debes seleccionar un rol para el usuario.","warning");return}this.selectedUsuario.groups=[this.rolSeleccionado];let e=new FormData;for(let o in this.selectedUsuario){if(!this.isEditMode&&(o==="activo"||o==="fecha_ingreso"))continue;let C=this.selectedUsuario[o];C!=null&&C!==""&&(Array.isArray(C)?C.forEach($=>e.append(o,$)):e.append(o,C))}!this.isEditMode&&this.password&&e.append("password",this.password),this.selectedFile&&e.append("foto_perfil",this.selectedFile);let r=this.isEditMode?`http://137.184.94.190/api/usuarios/${this.selectedUsuario.id}/`:"http://137.184.94.190/api/usuarios/",t=this.isEditMode?this.http.patch(r,e):this.http.post(r,e);this.isSaving=!0,t.subscribe(()=>{b.default.fire("Guardado",`Usuario ${this.isEditMode?"actualizado":"creado"} correctamente.`,"success"),this.loadUsuarios(),this.showModal=!1,this.isSaving=!1},o=>{this.isSaving=!1,this.handleHttpError(o)})}deleteUsuario(e){b.default.fire({title:"\xBFEst\xE1s seguro?",text:"Esta acci\xF3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar"}).then(r=>{r.isConfirmed&&this.http.delete(`http://137.184.94.190/api/usuarios/${e}/`).subscribe(()=>{b.default.fire("Eliminado","El usuario ha sido eliminado correctamente.","success"),this.loadUsuarios()},t=>this.handleHttpError(t))})}closeModal(){this.showModal=!1,this.selectedFile=null,this.previewImage=null,this.password="",this.rolSeleccionado=null}handleHttpError(e){b.default.fire("Error","Ha ocurrido un error. Int\xE9ntalo nuevamente.","error"),console.error("HTTP Error:",e)}static{this.\u0275fac=function(r){return new(r||l)(F(G))}}static{this.\u0275cmp=P({type:l,selectors:[["app-usuarios"]],viewQuery:function(r,t){if(r&1&&W(ie,5),r&2){let o;O(o=A())&&(t.fileInput=o.first)}},standalone:!0,features:[B],decls:2,vars:2,consts:[["noFoto",""],["noRole",""],["noPreview",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","justify-between","items-center","mb-6","flex-wrap","gap-4"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],["type","text","placeholder","Buscar por username o email...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white","text-left"],[1,"p-3"],[1,"p-3","text-center"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 rounded-xl",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],["alt","Foto","class","w-10 h-10 rounded-full object-cover border border-gray-300",3,"src",4,"ngIf","ngIfElse"],[4,"ngIf","ngIfElse"],[1,"p-3","text-center","space-x-4"],["title","Editar",1,"text-blue-500","hover:text-blue-700","transition","flex","items-center","gap-1",3,"click"],["title","Eliminar",1,"text-red-500","hover:text-red-700","transition","flex","items-center","gap-1",3,"click"],["alt","Foto",1,"w-10","h-10","rounded-full","object-cover","border","border-gray-300",3,"src"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-10","w-10","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.657 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"],["class","bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs mr-1",4,"ngFor","ngForOf"],[1,"bg-purple-100","text-purple-800","px-2","py-1","rounded","text-xs","mr-1"],[1,"text-gray-400","text-xs","italic"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","text-black","w-full","max-w-4xl","max-h-[90vh]","overflow-y-auto","rounded-xl","shadow-xl","p-8","border","border-purple-600"],[1,"text-3xl","font-bold","mb-6","text-center","text-purple-600","tracking-wide"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"flex","flex-col","items-center","gap-2"],["class","w-24 h-24 rounded-full object-cover border-4 border-purple-400 shadow-md",3,"src",4,"ngIf","ngIfElse"],["type","file","accept","image/*",1,"mt-2","w-full","px-3","py-2","rounded-lg","border","border-purple-300","bg-white","text-black","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"change"],[1,"block","font-bold","mb-1"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],["type","email",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],[4,"ngIf"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel","ngClass"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngIf"],[1,"mt-6","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"w-24","h-24","rounded-full","object-cover","border-4","border-purple-400","shadow-md",3,"src"],[1,"w-24","h-24","bg-gray-200","rounded-full","flex","items-center","justify-center","text-purple-500"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-10","w-10"],["type","password",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-pink-500","rounded-full","animate-spin"]],template:function(r,t){r&1&&f(0,re,2,0,"div",3)(1,he,48,8,"div",4),r&2&&(c("ngIf",t.isLoading),s(),c("ngIf",!t.isLoading))},dependencies:[H,R,N,z,Z,X,Y,Q,K,q,J],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return l})();export{Ee as UsuariosComponent};
