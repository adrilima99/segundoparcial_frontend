import{b as E,c as F,f as V,i as x,j as k,k as R,m as W}from"./chunk-5TRB5RNR.js";import{a as P}from"./chunk-IL2UONYL.js";import{b as v,c as D}from"./chunk-C5J56EWV.js";import{$a as i,Ka as o,La as y,Va as f,Ya as l,ab as n,bb as M,cc as S,e as L,fa as C,fb as _,gc as I,mb as r,ob as h,rb as p,sb as c,tb as g,vb as w}from"./chunk-RI4DZ32I.js";var T=L(P());function O(s,u){if(s&1&&(i(0,"option",8),r(1),n()),s&2){let a=u.$implicit;l("ngValue",a.id),o(),h(" ",a.nombre," ")}}function B(s,u){if(s&1&&(i(0,"option",8),r(1),n()),s&2){let a=u.$implicit;l("ngValue",a.id),o(),h(" ",a.nombre," ")}}function N(s,u){if(s&1&&(i(0,"option",8),r(1),n()),s&2){let a=u.$implicit;l("ngValue",a.id),o(),h(" ",a.nombre," ")}}var J=(()=>{class s{constructor(a){this.http=a,this.fechaInicio=null,this.fechaFin=null,this.categoriaId=null,this.subcategoriaId=null,this.marcaId=null,this.categorias=[],this.subcategorias=[],this.marcas=[],this.formato="pdf",this.isLoading=!1}ngOnInit(){this.cargarFiltros()}cargarFiltros(){this.http.get("http://137.184.94.190/api/categorias/").subscribe(a=>this.categorias=a),this.http.get("http://137.184.94.190/api/marcas/").subscribe(a=>this.marcas=a)}onCategoriaChange(){if(this.subcategoriaId=null,!this.categoriaId){this.subcategorias=[];return}this.http.get(`http://137.184.94.190/api/subcategorias/?categoria=${this.categoriaId}`).subscribe(a=>this.subcategorias=a)}generarReporte(){let a=new v().set("fecha_inicio",this.fechaInicio||"").set("fecha_fin",this.fechaFin||"").set("categoria",this.categoriaId?.toString()||"").set("subcategoria",this.subcategoriaId?.toString()||"").set("marca",this.marcaId?.toString()||"");console.log("\u{1F50D} Par\xE1metros enviados:",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,categoria:this.categoriaId,subcategoria:this.subcategoriaId,marca:this.marcaId});let m=this.formato==="pdf"?"http://137.184.94.190/api/reportes/productos-mas-vendidos/pdf/":"http://137.184.94.190/api/reportes/productos-mas-vendidos/excel/";this.isLoading=!0,this.http.get(m,{params:a,responseType:"blob"}).subscribe({next:e=>{let d=new Blob([e],{type:this.formato==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(d),b=document.createElement("a");b.href=t,b.download=this.formato==="pdf"?"mas_vendidos.pdf":"mas_vendidos.xlsx",b.click(),this.isLoading=!1},error:e=>{this.isLoading=!1,T.default.fire("Error","No se pudo generar el reporte.","error"),console.error(e)}})}static{this.\u0275fac=function(m){return new(m||s)(y(D))}}static{this.\u0275cmp=C({type:s,selectors:[["app-reportes-mas-vendidos"]],standalone:!0,features:[w],decls:45,vars:15,consts:[[1,"min-h-screen","bg-gradient-to-br","from-gray-100","via-white","to-purple-100","dark:from-gray-900","dark:via-gray-800","dark:to-purple-950","p-6","text-gray-900","dark:text-white"],[1,"container","mx-auto"],[1,"text-3xl","font-bold","mb-6","flex","items-center","gap-2"],["src","https://img.icons8.com/color/48/000000/sales-performance.png",1,"w-8","h-8"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mb-6"],[1,"block","font-semibold","mb-1"],["type","date",1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel","disabled"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],["value","pdf"],["value","excel"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-3","rounded-lg","shadow","font-bold","transition",3,"click","disabled"]],template:function(m,e){m&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),M(3,"img",3),r(4," Productos M\xE1s Vendidos "),n(),i(5,"div",4)(6,"div")(7,"label",5),r(8,"\u{1F4C5} Fecha Inicio"),n(),i(9,"input",6),g("ngModelChange",function(t){return c(e.fechaInicio,t)||(e.fechaInicio=t),t}),n()(),i(10,"div")(11,"label",5),r(12,"\u{1F4C5} Fecha Fin"),n(),i(13,"input",6),g("ngModelChange",function(t){return c(e.fechaFin,t)||(e.fechaFin=t),t}),n()(),i(14,"div")(15,"label",5),r(16,"\u{1F4C1} Categor\xEDa"),n(),i(17,"select",7),g("ngModelChange",function(t){return c(e.categoriaId,t)||(e.categoriaId=t),t}),_("change",function(){return e.onCategoriaChange()}),i(18,"option",8),r(19,"Todas"),n(),f(20,O,2,2,"option",9),n()(),i(21,"div")(22,"label",5),r(23,"\u{1F4C2} Subcategor\xEDa"),n(),i(24,"select",10),g("ngModelChange",function(t){return c(e.subcategoriaId,t)||(e.subcategoriaId=t),t}),i(25,"option",8),r(26,"Todas"),n(),f(27,B,2,2,"option",9),n()(),i(28,"div")(29,"label",5),r(30,"\u{1F3F7}\uFE0F Marca"),n(),i(31,"select",11),g("ngModelChange",function(t){return c(e.marcaId,t)||(e.marcaId=t),t}),i(32,"option",8),r(33,"Todas"),n(),f(34,N,2,2,"option",9),n()(),i(35,"div")(36,"label",5),r(37,"\u{1F4C2} Formato"),n(),i(38,"select",11),g("ngModelChange",function(t){return c(e.formato,t)||(e.formato=t),t}),i(39,"option",12),r(40,"\u{1F4C4} PDF"),n(),i(41,"option",13),r(42,"\u{1F4CA} Excel"),n()()()(),i(43,"button",14),_("click",function(){return e.generarReporte()}),r(44),n()()()),m&2&&(o(9),p("ngModel",e.fechaInicio),o(4),p("ngModel",e.fechaFin),o(4),p("ngModel",e.categoriaId),o(),l("ngValue",null),o(2),l("ngForOf",e.categorias),o(4),p("ngModel",e.subcategoriaId),l("disabled",!e.categoriaId||e.subcategorias.length===0),o(),l("ngValue",null),o(2),l("ngForOf",e.subcategorias),o(4),p("ngModel",e.marcaId),o(),l("ngValue",null),o(2),l("ngForOf",e.marcas),o(4),p("ngModel",e.formato),o(5),l("disabled",e.isLoading),o(),h(" \u2699\uFE0F ",e.isLoading?"Generando...":"Generar Reporte"," "))},dependencies:[I,S,W,k,R,E,x,F,V]})}}return s})();export{J as ReportesMasVendidosComponent};
