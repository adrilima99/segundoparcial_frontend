import{a as H,b as N,c as G,f as R,m as Q}from"./chunk-5TRB5RNR.js";import{a as q}from"./chunk-IL2UONYL.js";import{c as A}from"./chunk-C5J56EWV.js";import{$a as n,Ab as P,Ga as E,Ka as s,La as T,Va as _,Ya as p,a as k,ab as r,bb as f,cc as W,dc as z,e as U,eb as w,fa as I,fb as m,gb as d,gc as B,ib as F,jb as D,kb as O,lb as M,mb as a,nb as v,oa as c,ob as S,pa as g,pb as j,qa as y,ra as V,rb as x,sb as h,tb as C,vb as L}from"./chunk-RI4DZ32I.js";var b=U(q());var J=["fileInput"];function K(o,u){o&1&&(n(0,"div",4),f(1,"div",5),r())}function X(o,u){if(o&1&&f(0,"img",29),o&2){let e=d().$implicit;p("src",e.foto_perfil_url,E)}}function Y(o,u){o&1&&(n(0,"span",30),a(1,"Sin imagen"),r())}function Z(o,u){if(o&1){let e=w();n(0,"tr",24)(1,"td",17),_(2,X,1,1,"img",25)(3,Y,2,0,"ng-template",null,0,P),r(),n(5,"td",17),a(6),r(),n(7,"td",17),a(8),r(),n(9,"td",17),a(10),r(),n(11,"td",26)(12,"button",27),m("click",function(){let t=c(e).$implicit,l=d(2);return g(l.editCategoria(t))}),a(13," \u270F\uFE0F "),n(14,"span"),a(15,"Editar"),r()(),n(16,"button",28),m("click",function(){let t=c(e).$implicit,l=d(2);return g(l.deleteCategoria(t.id))}),a(17," \u{1F5D1}\uFE0F "),n(18,"span"),a(19,"Eliminar"),r()()()()}if(o&2){let e=u.$implicit,i=M(4);s(2),p("ngIf",e.foto_perfil_url)("ngIfElse",i),s(4),v(e.nombre),s(2),v(e.descripcion||"\u2014"),s(2),v(e.estado?"Activo":"Inactivo")}}function $(o,u){if(o&1&&f(0,"img",47),o&2){let e=d(3);p("src",e.previewImage,E)}}function ee(o,u){o&1&&(n(0,"div",48),y(),n(1,"svg",49),f(2,"path",50),r()())}function te(o,u){o&1&&(n(0,"div",51),f(1,"div",52),r())}function ie(o,u){if(o&1){let e=w();n(0,"div",31)(1,"div",32)(2,"h2",33),a(3),r(),n(4,"div",34)(5,"div",35),_(6,$,1,1,"img",36)(7,ee,3,0,"ng-template",null,1,P),n(9,"input",37),m("change",function(t){c(e);let l=d(2);return g(l.onFileSelected(t))}),r()(),n(10,"div")(11,"label",38),a(12,"\u{1F4DB} Nombre"),r(),n(13,"input",39),C("ngModelChange",function(t){c(e);let l=d(2);return h(l.selectedCategoria.nombre,t)||(l.selectedCategoria.nombre=t),g(t)}),r()(),n(14,"div")(15,"label",38),a(16,"\u{1F4DD} Descripci\xF3n"),r(),n(17,"textarea",40),C("ngModelChange",function(t){c(e);let l=d(2);return h(l.selectedCategoria.descripcion,t)||(l.selectedCategoria.descripcion=t),g(t)}),r()(),n(18,"div",41)(19,"input",42),C("ngModelChange",function(t){c(e);let l=d(2);return h(l.selectedCategoria.estado,t)||(l.selectedCategoria.estado=t),g(t)}),r(),n(20,"label"),a(21,"Activo"),r()(),n(22,"div",43)(23,"button",44),m("click",function(){c(e);let t=d(2);return g(t.saveCategoria())}),a(24),r(),n(25,"button",45),m("click",function(){c(e);let t=d(2);return g(t.closeModal())}),a(26," \u274C Cancelar "),r()()(),_(27,te,2,0,"div",46),r()()}if(o&2){let e=M(8),i=d(2);s(3),S(" ",i.isEditMode?"\u270F\uFE0F Editar Categor\xEDa":"\u2795 Nueva Categor\xEDa"," "),s(3),p("ngIf",i.previewImage)("ngIfElse",e),s(7),x("ngModel",i.selectedCategoria.nombre),s(4),x("ngModel",i.selectedCategoria.descripcion),s(2),x("ngModel",i.selectedCategoria.estado),s(5),S(" ",i.isEditMode?"\u{1F4BE} Actualizar":"\u2705 Guardar"," "),s(3),p("ngIf",i.isSaving)}}function ne(o,u){if(o&1){let e=w();n(0,"div",6)(1,"h1",7),a(2,"Gestionar Categor\xEDas"),r(),n(3,"div",8)(4,"div")(5,"button",9),m("click",function(){c(e);let t=d();return g(t.addCategoria())}),y(),n(6,"svg",10),f(7,"path",11),r(),a(8," A\xF1adir Categor\xEDa "),r()(),V(),n(9,"div",12)(10,"input",13),C("ngModelChange",function(t){c(e);let l=d();return h(l.searchTerm,t)||(l.searchTerm=t),g(t)}),m("ngModelChange",function(){c(e);let t=d();return g(t.filterCategorias())}),r()()(),n(11,"div",14)(12,"table",15)(13,"thead")(14,"tr",16)(15,"th",17),a(16,"Imagen"),r(),n(17,"th",17),a(18,"Nombre"),r(),n(19,"th",17),a(20,"Descripci\xF3n"),r(),n(21,"th",17),a(22,"Estado"),r(),n(23,"th",18),a(24,"Acciones"),r()()(),n(25,"tbody"),_(26,Z,20,5,"tr",19),r()()(),n(27,"div",20)(28,"button",21),m("click",function(){c(e);let t=d();return g(t.prevPage())}),a(29,"Anterior"),r(),n(30,"span",22),a(31),r(),n(32,"button",21),m("click",function(){c(e);let t=d();return g(t.nextPage())}),a(33,"Siguiente"),r()(),_(34,ie,28,8,"div",23),r()}if(o&2){let e=d();s(10),x("ngModel",e.searchTerm),s(16),p("ngForOf",e.paginatedCategorias()),s(2),p("disabled",e.currentPage===1),s(3),j("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),s(),p("disabled",e.currentPage===e.totalPages()),s(2),p("ngIf",e.showModal)}}var ce=(()=>{class o{constructor(e){this.http=e,this.isLoading=!1,this.isSaving=!1,this.categorias=[],this.filteredCategorias=[],this.selectedCategoria={id:0,nombre:"",descripcion:null,estado:!0,foto_perfil:null,foto_perfil_url:null},this.selectedFile=null,this.previewImage=null,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5,this.showModal=!1,this.isEditMode=!1}ngOnInit(){this.loadCategorias()}loadCategorias(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/categorias/").subscribe({next:e=>{this.categorias=e,this.filteredCategorias=e,this.isLoading=!1},error:e=>{this.isLoading=!1,this.handleHttpError(e)}})}filterCategorias(){this.currentPage=1;let e=this.searchTerm.toLowerCase();this.filteredCategorias=this.categorias.filter(i=>i.nombre.toLowerCase().includes(e))}paginatedCategorias(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredCategorias.slice(e,e+this.itemsPerPage)}totalPages(){return Math.ceil(this.filteredCategorias.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}addCategoria(){this.selectedCategoria={id:0,nombre:"",descripcion:null,estado:!0,foto_perfil:null,foto_perfil_url:null},this.previewImage=null,this.selectedFile=null,this.isEditMode=!1,this.showModal=!0}editCategoria(e){this.selectedCategoria=k({},e),this.previewImage=e.foto_perfil_url||null,this.selectedFile=null,this.isEditMode=!0,this.showModal=!0}onFileSelected(e){let i=e.target.files[0];if(i){this.selectedFile=i;let t=new FileReader;t.onload=()=>this.previewImage=t.result,t.readAsDataURL(i)}}saveCategoria(){let e=new FormData;e.append("nombre",this.selectedCategoria.nombre),this.selectedCategoria.descripcion&&e.append("descripcion",this.selectedCategoria.descripcion),e.append("estado",this.selectedCategoria.estado.toString()),this.selectedFile&&e.append("foto_perfil",this.selectedFile);let i=this.isEditMode?`http://137.184.94.190/api/categorias/${this.selectedCategoria.id}/`:"http://137.184.94.190/api/categorias/",t=this.isEditMode?this.http.patch(i,e):this.http.post(i,e);this.isSaving=!0,t.subscribe({next:()=>{b.default.fire("Guardado",`Categor\xEDa ${this.isEditMode?"actualizada":"creada"} correctamente.`,"success"),this.loadCategorias(),this.showModal=!1,this.isSaving=!1},error:l=>{this.isSaving=!1,this.handleHttpError(l)}})}deleteCategoria(e){b.default.fire({title:"\xBFEliminar categor\xEDa?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar"}).then(i=>{i.isConfirmed&&this.http.delete(`http://137.184.94.190/api/categorias/${e}/`).subscribe({next:()=>{b.default.fire("Eliminado","La categor\xEDa fue eliminada.","success"),this.loadCategorias()},error:t=>this.handleHttpError(t)})})}closeModal(){this.showModal=!1,this.selectedFile=null,this.previewImage=null}handleHttpError(e){console.error("HTTP Error:",e),b.default.fire("Error","Ocurri\xF3 un error en el servidor.","error")}static{this.\u0275fac=function(i){return new(i||o)(T(A))}}static{this.\u0275cmp=I({type:o,selectors:[["app-categorias"]],viewQuery:function(i,t){if(i&1&&F(J,5),i&2){let l;D(l=O())&&(t.fileInput=l.first)}},standalone:!0,features:[L],decls:2,vars:2,consts:[["noFoto",""],["noPreview",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","justify-between","items-center","mb-6","flex-wrap","sm:flex-nowrap","gap-4"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"w-full","sm:w-auto","sm:ml-auto"],["type","text","placeholder","Buscar por nombre...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white","text-left"],[1,"p-3"],[1,"p-3","text-center"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],["alt","Imagen","class","w-10 h-10 rounded object-cover border",3,"src",4,"ngIf","ngIfElse"],[1,"p-3","text-center","space-x-4"],["title","Editar",1,"text-blue-500","hover:text-blue-700","transition","flex","items-center","gap-1",3,"click"],["title","Eliminar",1,"text-red-500","hover:text-red-700","transition","flex","items-center","gap-1",3,"click"],["alt","Imagen",1,"w-10","h-10","rounded","object-cover","border",3,"src"],[1,"text-gray-400","text-xs","italic"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","text-black","w-full","max-w-lg","p-8","rounded-xl","shadow-xl","relative"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"flex","flex-col","items-center","gap-2"],["class","w-24 h-24 rounded object-cover border-4 border-purple-400 shadow-md",3,"src",4,"ngIf","ngIfElse"],["type","file","accept","image/*",1,"mt-2","w-full","px-3","py-2","rounded-lg","border","border-purple-300","bg-white","text-black","focus:outline-none","focus:ring-2","focus:ring-purple-500",3,"change"],[1,"block","font-bold","mb-1"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-2"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"mt-4","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 rounded-xl",4,"ngIf"],[1,"w-24","h-24","rounded","object-cover","border-4","border-purple-400","shadow-md",3,"src"],[1,"w-24","h-24","bg-gray-200","rounded","flex","items-center","justify-center","text-purple-500"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-10","w-10"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.657 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(i,t){i&1&&_(0,K,2,0,"div",2)(1,ne,35,7,"div",3),i&2&&(p("ngIf",t.isLoading),s(),p("ngIf",!t.isLoading))},dependencies:[B,W,z,Q,N,H,G,R],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return o})();export{ce as CategoriasComponent};
