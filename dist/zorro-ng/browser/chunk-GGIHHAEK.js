import{b as N,c as W,f as z,h as H,i as A,j as R,k as G,m as J}from"./chunk-5TRB5RNR.js";import{a as K}from"./chunk-IL2UONYL.js";import{c as F}from"./chunk-C5J56EWV.js";import{$a as n,Ka as d,La as E,Va as _,Ya as p,ab as o,bb as M,cc as D,dc as L,e as q,eb as w,ec as B,fa as y,fb as u,gb as l,gc as j,mb as r,nb as h,oa as c,ob as I,pa as m,pb as k,qa as P,ra as S,rb as x,sb as f,tb as b,vb as V,yb as T,zb as O}from"./chunk-RI4DZ32I.js";var C=q(K());function Q(s,g){s&1&&(n(0,"div",2),M(1,"div",3),o())}function U(s,g){if(s&1&&(n(0,"tr",22)(1,"td",16),r(2),o(),n(3,"td",23),r(4),o(),n(5,"td",16),r(6),o(),n(7,"td",16),r(8),o(),n(9,"td",16),r(10),T(11,"date"),o()()),s&2){let e=g.$implicit,i=l(2);d(2),h(i.getNombreProducto(e.producto)),d(2),h(e.tipo),d(2),h(e.cantidad),d(2),h(e.descripcion||"\u2014"),d(2),h(O(11,5,e.fecha_movimiento,"short"))}}function X(s,g){if(s&1){let e=w();n(0,"li",42),u("click",function(){let t=c(e).$implicit,a=l(4);return m(a.selectProducto(t.id))}),r(1),o()}if(s&2){let e=g.$implicit;d(),I(" ",e.nombre," ")}}function Y(s,g){if(s&1&&(n(0,"ul",40),_(1,X,2,1,"li",41),o()),s&2){let e=l(3);d(),p("ngForOf",e.getProductosFiltradosPorNombre())}}function Z(s,g){s&1&&(n(0,"div",43),M(1,"div",44),o())}function $(s,g){if(s&1){let e=w();n(0,"div",24)(1,"div",25)(2,"h2",26),r(3,"\u2795 Registrar Movimiento"),o(),n(4,"div",27)(5,"label",28),r(6,"\u{1F4E6} Producto"),o(),n(7,"input",29),b("ngModelChange",function(t){c(e);let a=l(2);return f(a.productoBuscado,t)||(a.productoBuscado=t),m(t)}),u("input",function(){c(e);let t=l(2);return m(t.mostrarListaProductos=!0)}),o(),_(8,Y,2,1,"ul",30),n(9,"label",28),r(10,"\u{1F4C4} Tipo de Movimiento"),o(),n(11,"select",31),b("ngModelChange",function(t){c(e);let a=l(2);return f(a.nuevoMovimiento.tipo,t)||(a.nuevoMovimiento.tipo=t),m(t)}),n(12,"option",32),r(13,"Entrada"),o(),n(14,"option",33),r(15,"Salida"),o()(),n(16,"label",28),r(17,"\u{1F4E6} Cantidad"),o(),n(18,"input",34),b("ngModelChange",function(t){c(e);let a=l(2);return f(a.nuevoMovimiento.cantidad,t)||(a.nuevoMovimiento.cantidad=t),m(t)}),o(),n(19,"label",28),r(20,"\u{1F4DD} Descripci\xF3n"),o(),n(21,"textarea",35),b("ngModelChange",function(t){c(e);let a=l(2);return f(a.nuevoMovimiento.descripcion,t)||(a.nuevoMovimiento.descripcion=t),m(t)}),o()(),n(22,"div",36)(23,"button",37),u("click",function(){c(e);let t=l(2);return m(t.saveMovimiento())}),r(24," \u2705 Registrar "),o(),n(25,"button",38),u("click",function(){c(e);let t=l(2);return m(t.closeModal())}),r(26," \u274C Cancelar "),o()(),_(27,Z,2,0,"div",39),o()()}if(s&2){let e=l(2);d(7),x("ngModel",e.productoBuscado),d(),p("ngIf",e.productoBuscado&&e.getProductosFiltradosPorNombre().length>0&&e.mostrarListaProductos),d(3),x("ngModel",e.nuevoMovimiento.tipo),d(7),x("ngModel",e.nuevoMovimiento.cantidad),d(3),x("ngModel",e.nuevoMovimiento.descripcion),d(6),p("ngIf",e.isSaving)}}function ee(s,g){if(s&1){let e=w();n(0,"div",4)(1,"h1",5),r(2,"Gestionar Movimientos de Inventario"),o(),n(3,"div",6)(4,"div",7)(5,"button",8),u("click",function(){c(e);let t=l();return m(t.addMovimiento())}),P(),n(6,"svg",9),M(7,"path",10),o(),r(8," Registrar Movimiento "),o()(),S(),n(9,"div",11)(10,"input",12),b("ngModelChange",function(t){c(e);let a=l();return f(a.searchTerm,t)||(a.searchTerm=t),m(t)}),u("ngModelChange",function(){c(e);let t=l();return m(t.filterMovimientos())}),o()()(),n(11,"div",13)(12,"table",14)(13,"thead",15)(14,"tr")(15,"th",16),r(16,"Producto"),o(),n(17,"th",16),r(18,"Tipo"),o(),n(19,"th",16),r(20,"Cantidad"),o(),n(21,"th",16),r(22,"Descripci\xF3n"),o(),n(23,"th",16),r(24,"Fecha"),o()()(),n(25,"tbody"),_(26,U,12,8,"tr",17),o()()(),n(27,"div",18)(28,"button",19),u("click",function(){c(e);let t=l();return m(t.prevPage())}),r(29,"Anterior"),o(),n(30,"span",20),r(31),o(),n(32,"button",19),u("click",function(){c(e);let t=l();return m(t.nextPage())}),r(33,"Siguiente"),o()(),_(34,$,28,6,"div",21),o()}if(s&2){let e=l();d(10),x("ngModel",e.searchTerm),d(16),p("ngForOf",e.paginatedMovimientos()),d(2),p("disabled",e.currentPage===1),d(3),k("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),d(),p("disabled",e.currentPage===e.totalPages()),d(2),p("ngIf",e.showModal)}}var se=(()=>{class s{constructor(e){this.http=e,this.movimientos=[],this.productos=[],this.subcategorias=[],this.categorias=[],this.nuevoMovimiento=this.getEmptyMovimiento(),this.searchTerm="",this.currentPage=1,this.itemsPerPage=5,this.showModal=!1,this.isLoading=!1,this.isSaving=!1,this.productoBuscado="",this.mostrarListaProductos=!0}ngOnInit(){this.loadMovimientos(),this.loadProductos(),this.loadCategorias(),this.loadSubcategorias()}getEmptyMovimiento(){return{id:0,producto:0,tipo:"entrada",cantidad:0,descripcion:""}}loadMovimientos(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/movimientos/").subscribe({next:e=>{this.movimientos=e,this.isLoading=!1},error:e=>{this.isLoading=!1,this.handleHttpError(e)}})}loadProductos(){this.http.get("http://137.184.94.190/api/productos/?sin_stock=all&limit=100").subscribe({next:e=>{this.productos=e.results},error:e=>this.handleHttpError(e)})}loadCategorias(){this.http.get("http://137.184.94.190/api/categorias/").subscribe(e=>this.categorias=e)}loadSubcategorias(){this.http.get("http://137.184.94.190/api/subcategorias/").subscribe(e=>this.subcategorias=e)}getNombreProducto(e){let i=this.productos.find(t=>t.id===e);return i?i.nombre:"Producto no encontrado"}getNombreCategoriaDesdeProducto(e){let i=this.productos.find(v=>v.id===e),t=this.subcategorias.find(v=>v.id===i?.subcategoria),a=this.categorias.find(v=>v.id===t?.categoria);return a?a.nombre:"\u2014"}getNombreSubcategoriaDesdeProducto(e){let i=this.productos.find(a=>a.id===e),t=this.subcategorias.find(a=>a.id===i?.subcategoria);return t?t.nombre:"\u2014"}getProductosFiltradosPorNombre(){let e=this.productoBuscado.toLowerCase();return this.productos.filter(i=>i.nombre.toLowerCase().includes(e))}selectProducto(e){this.nuevoMovimiento.producto=e;let i=this.productos.find(t=>t.id===e);this.productoBuscado=i?.nombre||"",this.mostrarListaProductos=!1}addMovimiento(){this.nuevoMovimiento=this.getEmptyMovimiento(),this.productoBuscado="",this.mostrarListaProductos=!0,this.showModal=!0}closeModal(){this.showModal=!1,this.nuevoMovimiento=this.getEmptyMovimiento(),this.productoBuscado="",this.mostrarListaProductos=!0}saveMovimiento(){this.isSaving=!0,this.http.post("http://137.184.94.190/api/movimientos/",this.nuevoMovimiento).subscribe({next:()=>{C.default.fire("Registrado","Movimiento creado correctamente.","success"),this.loadMovimientos(),this.closeModal(),this.isSaving=!1},error:e=>{this.isSaving=!1,C.default.fire("Error",this.formatErrors(e?.error),"error")}})}filterMovimientos(){let e=this.searchTerm.toLowerCase();return this.movimientos.filter(i=>this.getNombreProducto(i.producto).toLowerCase().includes(e))}paginatedMovimientos(){let e=this.filterMovimientos(),i=(this.currentPage-1)*this.itemsPerPage;return e.slice(i,i+this.itemsPerPage)}totalPages(){return Math.ceil(this.filterMovimientos().length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}handleHttpError(e){console.error("HTTP Error:",e),C.default.fire("Error",this.formatErrors(e?.error),"error")}formatErrors(e){return!e||typeof e!="object"?"Error desconocido":Object.entries(e).map(([i,t])=>Array.isArray(t)?`<strong>${i}:</strong> ${t.join(", ")}`:t&&typeof t=="object"?`<strong>${i}:</strong><br>`+Object.entries(t).map(([a,v])=>`\u2192 ${a}: ${v}`).join("<br>"):`<strong>${i}:</strong> ${JSON.stringify(t)}`).join("<br>")}static{this.\u0275fac=function(i){return new(i||s)(E(F))}}static{this.\u0275cmp=y({type:s,selectors:[["app-movimientos"]],standalone:!0,features:[V],decls:2,vars:2,consts:[["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4","mb-6"],[1,"flex-shrink-0"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"w-full","sm:w-auto"],["type","text","placeholder","Buscar producto...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white"],[1,"p-3"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],[1,"p-3","capitalize"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","w-full","max-w-lg","p-6","rounded-xl","shadow-xl","relative","overflow-y-auto","max-h-[90vh]"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"block","font-bold","mb-1"],["type","text","placeholder","Buscar producto...",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","input","ngModel"],["class","bg-white border border-gray-300 rounded-md shadow max-h-40 overflow-y-auto mt-1 text-black z-10 relative",4,"ngIf"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],["value","entrada"],["value","salida"],["type","number",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],["rows","2","placeholder","Motivo del movimiento...",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[1,"mt-6","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-xl",4,"ngIf"],[1,"bg-white","border","border-gray-300","rounded-md","shadow","max-h-40","overflow-y-auto","mt-1","text-black","z-10","relative"],["class","px-3 py-2 hover:bg-purple-100 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"px-3","py-2","hover:bg-purple-100","cursor-pointer",3,"click"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(i,t){i&1&&_(0,Q,2,0,"div",0)(1,ee,35,7,"div",1),i&2&&(p("ngIf",t.isLoading),d(),p("ngIf",!t.isLoading))},dependencies:[j,D,L,B,J,R,G,N,H,A,W,z],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return s})();export{se as MovimientoInventarioComponent};
