import{b as W,c as z,f as j,m as N}from"./chunk-5TRB5RNR.js";import{a as G}from"./chunk-IL2UONYL.js";import{c as B}from"./chunk-C5J56EWV.js";import{$a as i,Ab as D,Ka as l,La as E,Va as _,Ya as u,ab as n,bb as P,cc as V,dc as k,e as K,eb as g,ec as T,fa as M,fb as f,gb as s,gc as L,lb as S,mb as o,nb as x,oa as d,ob as w,pa as p,rb as C,sb as b,tb as v,vb as F,yb as O,zb as I}from"./chunk-RI4DZ32I.js";var h=K(G());function R(r,m){r&1&&(i(0,"div",3),P(1,"div",4),n())}function q(r,m){if(r&1){let t=g();i(0,"button",21),f("click",function(){d(t);let e=s().$implicit,c=s(2);return p(c.verProductos(e))}),o(1," \u{1F6D2} "),i(2,"span"),o(3,"Ver Productos"),n()()}}function J(r,m){if(r&1){let t=g();i(0,"tr",17)(1,"td",13),o(2),n(),i(3,"td",13),o(4),n(),i(5,"td",13),o(6),n(),i(7,"td",13),o(8),O(9,"date"),n(),i(10,"td",18),_(11,q,4,0,"button",19),i(12,"button",20),f("click",function(){let e=d(t).$implicit,c=s(2);return p(c.eliminarCarrito(e.id))}),o(13," \u{1F5D1}\uFE0F "),i(14,"span"),o(15,"Eliminar"),n()()()()}if(r&2){let t=m.$implicit;l(2),x(t.usuario_nombre),l(2),x(t.estado),l(2),w("Bs ",t.total_estimado,""),l(2),x(I(9,5,t.fecha_actualizacion,"short")),l(3),u("ngIf",t.estado==="activo")}}function Q(r,m){if(r&1&&(i(0,"tr",32)(1,"td",33),o(2),n(),i(3,"td",33),o(4),n(),i(5,"td",33),o(6),n()()),r&2){let t=m.$implicit;l(2),x(t.producto.nombre),l(2),w("Bs ",t.producto.precio_unitario,""),l(2),x(t.cantidad)}}function X(r,m){if(r&1&&(i(0,"div")(1,"table",28)(2,"thead",29)(3,"tr")(4,"th",30),o(5,"Producto"),n(),i(6,"th",30),o(7,"Precio"),n(),i(8,"th",30),o(9,"Cantidad"),n()()(),i(10,"tbody"),_(11,Q,7,3,"tr",31),n()()()),r&2){let t=s(3);l(11),u("ngForOf",t.productosDelCarrito)}}function Y(r,m){r&1&&(i(0,"p",34),o(1,"Este carrito no tiene productos."),n())}function Z(r,m){if(r&1){let t=g();i(0,"div",22)(1,"div",23)(2,"h2",24),o(3,"\u{1F6CD}\uFE0F Productos del Carrito"),n(),_(4,X,12,1,"div",25)(5,Y,2,0,"ng-template",null,0,D),i(7,"div",26)(8,"button",27),f("click",function(){d(t);let e=s(2);return p(e.cerrarModal())}),o(9," \u274C Cerrar "),n()()()()}if(r&2){let t=S(6),a=s(2);l(4),u("ngIf",a.productosDelCarrito.length>0)("ngIfElse",t)}}function $(r,m){if(r&1){let t=g();i(0,"div",5)(1,"h1",6),o(2,"Gestionar Carritos"),n(),i(3,"div",7)(4,"input",8),v("ngModelChange",function(e){d(t);let c=s();return b(c.filtroUsuario,e)||(c.filtroUsuario=e),p(e)}),f("ngModelChange",function(){d(t);let e=s();return p(e.filtrarCarritos())}),n(),i(5,"input",9),v("ngModelChange",function(e){d(t);let c=s();return b(c.filtroFechaInicio,e)||(c.filtroFechaInicio=e),p(e)}),f("ngModelChange",function(){d(t);let e=s();return p(e.filtrarCarritos())}),n(),i(6,"input",9),v("ngModelChange",function(e){d(t);let c=s();return b(c.filtroFechaFin,e)||(c.filtroFechaFin=e),p(e)}),f("ngModelChange",function(){d(t);let e=s();return p(e.filtrarCarritos())}),n()(),i(7,"div",10)(8,"table",11)(9,"thead",12)(10,"tr")(11,"th",13),o(12,"Usuario"),n(),i(13,"th",13),o(14,"Estado"),n(),i(15,"th",13),o(16,"Total Estimado"),n(),i(17,"th",13),o(18,"Fecha"),n(),i(19,"th",14),o(20,"Acciones"),n()()(),i(21,"tbody"),_(22,J,16,8,"tr",15),n()()(),_(23,Z,10,2,"div",16),n()}if(r&2){let t=s();l(4),C("ngModel",t.filtroUsuario),l(),C("ngModel",t.filtroFechaInicio),l(),C("ngModel",t.filtroFechaFin),l(16),u("ngForOf",t.carritosFiltrados),l(),u("ngIf",t.showProductosModal)}}var at=(()=>{class r{constructor(t){this.http=t,this.carritos=[],this.carritosFiltrados=[],this.isLoading=!1,this.showProductosModal=!1,this.productosDelCarrito=[],this.filtroUsuario="",this.filtroFechaInicio="",this.filtroFechaFin=""}ngOnInit(){this.obtenerCarritos()}obtenerCarritos(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/carritos/todos/").subscribe({next:t=>{this.carritos=t,this.filtrarCarritos(),this.isLoading=!1},error:t=>{this.isLoading=!1,h.default.fire("Error","No se pudieron cargar los carritos.","error"),console.error(t)}})}filtrarCarritos(){let t=this.filtroUsuario.toLowerCase(),a=this.filtroFechaInicio?new Date(this.filtroFechaInicio):null,e=this.filtroFechaFin?new Date(this.filtroFechaFin):null;this.carritosFiltrados=this.carritos.filter(c=>{let U=c.usuario_nombre.toLowerCase().includes(t),y=new Date(c.fecha_actualizacion),A=!a||y>=a,H=!e||y<=e;return U&&A&&H})}verProductos(t){this.productosDelCarrito=t.items,this.showProductosModal=!0}cerrarModal(){this.showProductosModal=!1,this.productosDelCarrito=[]}eliminarCarrito(t){h.default.fire({title:"\xBFEliminar carrito?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar"}).then(a=>{a.isConfirmed&&this.http.delete(`http://137.184.94.190/api/carritos/${t}/`).subscribe({next:()=>{h.default.fire("Eliminado","El carrito fue eliminado correctamente.","success"),this.obtenerCarritos()},error:e=>{h.default.fire("Error","No se pudo eliminar el carrito.","error"),console.error(e)}})})}static{this.\u0275fac=function(a){return new(a||r)(E(B))}}static{this.\u0275cmp=M({type:r,selectors:[["app-carrito"]],standalone:!0,features:[F],decls:2,vars:2,consts:[["noItems",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","flex-wrap","gap-4","items-center","mb-6"],["type","text","placeholder","Buscar por usuario...",1,"flex-1","min-w-[180px]","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],["type","date",1,"px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white"],[1,"p-3"],[1,"p-3","text-center"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],[1,"p-3","text-center","flex","justify-center","gap-4"],["class","text-blue-500 hover:text-blue-700 flex items-center gap-1",3,"click",4,"ngIf"],[1,"text-red-500","hover:text-red-700","flex","items-center","gap-1",3,"click"],[1,"text-blue-500","hover:text-blue-700","flex","items-center","gap-1",3,"click"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","text-black","w-full","max-w-2xl","p-6","rounded-xl","shadow-xl","relative","overflow-y-auto","max-h-[90vh]"],[1,"text-2xl","font-bold","text-center","text-purple-600","mb-4"],[4,"ngIf","ngIfElse"],[1,"mt-6","text-center"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"w-full","table-auto","border","text-sm"],[1,"bg-purple-100","text-purple-700"],[1,"p-2","text-left"],["class","border-b hover:bg-gray-100",4,"ngFor","ngForOf"],[1,"border-b","hover:bg-gray-100"],[1,"p-2"],[1,"text-center","text-gray-500"]],template:function(a,e){a&1&&_(0,R,2,0,"div",1)(1,$,24,5,"div",2),a&2&&(u("ngIf",e.isLoading),l(),u("ngIf",!e.isLoading))},dependencies:[L,V,k,T,N,W,z,j],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px;font-size:.95rem}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}input[type=text][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%], input[type=file][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;background-color:#f3f4f6}.spinner-modal[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#00000080;z-index:50;display:flex;justify-content:center;align-items:center;border-radius:1rem}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}.grid-cols-2[_ngcontent-%COMP%], .md\\:grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr!important}}"]})}}return r})();export{at as CarritoComponent};
