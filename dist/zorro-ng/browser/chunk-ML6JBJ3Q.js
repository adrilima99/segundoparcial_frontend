import{b as z,c as H,f as G,h as R,i as q,j as $,k as J,m as K}from"./chunk-5TRB5RNR.js";import{a as X}from"./chunk-IL2UONYL.js";import{c as A}from"./chunk-C5J56EWV.js";import{$a as n,Ka as c,La as O,Va as h,Ya as p,ab as o,bb as C,cc as F,dc as B,e as U,eb as v,ec as N,fa as M,fb as m,gb as d,gc as W,mb as r,nb as x,oa as l,ob as E,pa as u,pb as I,qa as V,ra as T,rb as f,sb as S,tb as k,vb as L,yb as j,zb as D}from"./chunk-RI4DZ32I.js";var y=U(X());function Y(s,g){s&1&&(n(0,"div",2),C(1,"div",3),o())}function Z(s,g){if(s&1&&(n(0,"option",13),r(1),o()),s&2){let t=g.$implicit;p("ngValue",t.id),c(),x(t.nombre)}}function tt(s,g){if(s&1&&(n(0,"option",13),r(1),o()),s&2){let t=g.$implicit;p("ngValue",t.id),c(),E(" ",t.nombre," ")}}function et(s,g){if(s&1&&(n(0,"tr",26)(1,"td",20),r(2),o(),n(3,"td",20),r(4),o(),n(5,"td",20),r(6),o(),n(7,"td",20),r(8),o(),n(9,"td",20),r(10),o(),n(11,"td",20),r(12),j(13,"date"),o()()),s&2){let t=g.$implicit,i=d(2);c(2),x(i.getNombreProducto(t.producto)),c(2),x(i.getNombreCategoriaDesdeProducto(t.producto)),c(2),x(i.getNombreSubcategoriaDesdeProducto(t.producto)),c(2),x(t.cantidad_actual),c(2),x(t.punto_reorden),c(2),x(D(13,6,t.fecha_actualizacion,"short"))}}function it(s,g){if(s&1){let t=v();n(0,"li",43),m("click",function(){let e=l(t).$implicit,a=d(4);return u(a.selectProducto(e.id))}),r(1),o()}if(s&2){let t=g.$implicit;c(),E(" ",t.nombre," ")}}function ot(s,g){if(s&1&&(n(0,"ul",41),h(1,it,2,1,"li",42),o()),s&2){let t=d(3);c(),p("ngForOf",t.getProductosFiltradosPorNombre())}}function nt(s,g){s&1&&(n(0,"div",44),C(1,"div",45),o())}function rt(s,g){if(s&1){let t=v();n(0,"div",27)(1,"div",28)(2,"h2",29),r(3,"\u2795 Registrar Stock"),o(),n(4,"div",30)(5,"div",31)(6,"p",32),r(7,"\u26A0 Importante:"),o(),n(8,"p"),r(9,"Solo puedes registrar productos que "),n(10,"strong"),r(11,"no tengan stock asignado"),o(),r(12,"."),o(),n(13,"p"),r(14,"Si el producto ya tiene stock, debes gestionarlo desde el m\xF3dulo "),n(15,"strong"),r(16,"Movimientos de Inventario"),o(),r(17,"."),o()(),n(18,"label",33),r(19,"\u{1F4E6} Producto"),o(),n(20,"input",34),k("ngModelChange",function(e){l(t);let a=d(2);return S(a.productoBuscado,e)||(a.productoBuscado=e),u(e)}),m("input",function(){l(t);let e=d(2);return u(e.mostrarListaProductos=!0)}),o(),h(21,ot,2,1,"ul",35),n(22,"label",33),r(23,"\u{1F4CA} Cantidad Actual"),o(),n(24,"input",36),k("ngModelChange",function(e){l(t);let a=d(2);return S(a.selectedStock.cantidad_actual,e)||(a.selectedStock.cantidad_actual=e),u(e)}),o(),n(25,"label",33),r(26,"\u{1F4C9} Punto de Reorden"),o(),n(27,"input",36),k("ngModelChange",function(e){l(t);let a=d(2);return S(a.selectedStock.punto_reorden,e)||(a.selectedStock.punto_reorden=e),u(e)}),o()(),n(28,"div",37)(29,"button",38),m("click",function(){l(t);let e=d(2);return u(e.saveStock())}),r(30," \u2705 Guardar "),o(),n(31,"button",39),m("click",function(){l(t);let e=d(2);return u(e.closeModal())}),r(32," \u274C Cancelar "),o()(),h(33,nt,2,0,"div",40),o()()}if(s&2){let t=d(2);c(20),f("ngModel",t.productoBuscado),c(),p("ngIf",t.productoBuscado&&t.getProductosFiltradosPorNombre().length>0&&t.mostrarListaProductos),c(3),f("ngModel",t.selectedStock.cantidad_actual),c(3),f("ngModel",t.selectedStock.punto_reorden),c(6),p("ngIf",t.isSaving)}}function at(s,g){if(s&1){let t=v();n(0,"div",4)(1,"h1",5),r(2,"Gestionar Stock"),o(),n(3,"div",6)(4,"div",7)(5,"button",8),m("click",function(){l(t);let e=d();return u(e.addStock())}),V(),n(6,"svg",9),C(7,"path",10),o(),r(8," Registrar Stock Inicial "),o(),T(),n(9,"div",11)(10,"select",12),k("ngModelChange",function(e){l(t);let a=d();return S(a.categoriaSeleccionada,e)||(a.categoriaSeleccionada=e),u(e)}),m("change",function(){l(t);let e=d();return u(e.filterStocks())}),n(11,"option",13),r(12,"Todas las categor\xEDas"),o(),h(13,Z,2,2,"option",14),o()(),n(14,"div",11)(15,"select",12),k("ngModelChange",function(e){l(t);let a=d();return S(a.subcategoriaSeleccionada,e)||(a.subcategoriaSeleccionada=e),u(e)}),m("change",function(){l(t);let e=d();return u(e.filterStocks())}),n(16,"option",13),r(17,"Todas las subcategor\xEDas"),o(),h(18,tt,2,2,"option",14),o()()(),n(19,"div",15)(20,"input",16),k("ngModelChange",function(e){l(t);let a=d();return S(a.searchTerm,e)||(a.searchTerm=e),u(e)}),m("ngModelChange",function(){l(t);let e=d();return u(e.filterStocks())}),o()()(),n(21,"div",17)(22,"table",18)(23,"thead",19)(24,"tr")(25,"th",20),r(26,"Producto"),o(),n(27,"th",20),r(28,"Categor\xEDa"),o(),n(29,"th",20),r(30,"Subcategor\xEDa"),o(),n(31,"th",20),r(32,"Cantidad"),o(),n(33,"th",20),r(34,"Punto Reorden"),o(),n(35,"th",20),r(36,"\xDAltima Actualizaci\xF3n"),o()()(),n(37,"tbody"),h(38,et,14,9,"tr",21),o()()(),n(39,"div",22)(40,"button",23),m("click",function(){l(t);let e=d();return u(e.prevPage())}),r(41,"Anterior"),o(),n(42,"span",24),r(43),o(),n(44,"button",23),m("click",function(){l(t);let e=d();return u(e.nextPage())}),r(45,"Siguiente"),o()(),h(46,rt,34,5,"div",25),o()}if(s&2){let t=d();c(10),f("ngModel",t.categoriaSeleccionada),c(),p("ngValue",null),c(2),p("ngForOf",t.categorias),c(2),f("ngModel",t.subcategoriaSeleccionada),c(),p("ngValue",null),c(2),p("ngForOf",t.getSubcategoriasFiltradas()),c(2),f("ngModel",t.searchTerm),c(18),p("ngForOf",t.paginatedStocks()),c(2),p("disabled",t.currentPage===1),c(3),I("P\xE1gina ",t.currentPage," de ",t.totalPages(),""),c(),p("disabled",t.currentPage===t.totalPages()),c(2),p("ngIf",t.showModal)}}var gt=(()=>{class s{constructor(t){this.http=t,this.stocks=[],this.productosConStock=[],this.productosSinStock=[],this.subcategorias=[],this.categorias=[],this.filteredStocks=[],this.selectedStock=this.getEmptyStock(),this.categoriaSeleccionada=null,this.subcategoriaSeleccionada=null,this.showModal=!1,this.isLoading=!1,this.isSaving=!1,this.productoBuscado="",this.mostrarListaProductos=!0,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5,this.productosPage=1,this.totalProductos=0,this.hasNextProductosPage=!1,this.hasPrevProductosPage=!1}ngOnInit(){this.loadStocks(),this.loadProductosTodos(),this.loadProductosSinStock(),this.loadCategorias(),this.loadSubcategorias()}getEmptyStock(){return{id:0,producto:0,cantidad_actual:0,punto_reorden:5}}loadStocks(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/stock/").subscribe({next:t=>{this.stocks=t,this.filterStocks(),this.isLoading=!1},error:t=>{this.isLoading=!1,this.handleHttpError(t)}})}loadProductosSinStock(t=1){this.http.get(`http://137.184.94.190/api/productos/?sin_stock=1&page=${t}`).subscribe({next:i=>{this.productosSinStock=i.results,this.totalProductos=i.count,this.hasNextProductosPage=!!i.next,this.hasPrevProductosPage=!!i.previous,this.productosPage=t},error:i=>this.handleHttpError(i)})}loadProductosTodos(t=1){this.http.get(`http://137.184.94.190/api/productos/?sin_stock=all&page=${t}`).subscribe({next:i=>{this.productosConStock=i.results,this.filterStocks()},error:i=>this.handleHttpError(i)})}loadCategorias(){this.http.get("http://137.184.94.190/api/categorias/").subscribe(t=>this.categorias=t)}loadSubcategorias(){this.http.get("http://137.184.94.190/api/subcategorias/").subscribe(t=>this.subcategorias=t)}getNombreProducto(t){let i=this.productosConStock.find(e=>e.id===t);return i?i.nombre:"Producto no encontrado"}getNombreSubcategoriaDesdeProducto(t){let i=this.productosConStock.find(_=>_.id===t),e=typeof i?.subcategoria=="object"?i.subcategoria.id:i?.subcategoria,a=this.subcategorias.find(_=>_.id===e);return a?a.nombre:"\u2014"}getNombreCategoriaDesdeProducto(t){let i=this.productosConStock.find(b=>b.id===t),e=typeof i?.subcategoria=="object"?i.subcategoria.id:i?.subcategoria,a=this.subcategorias.find(b=>b.id===e),_=typeof a?.categoria=="object"?a.categoria.id:a?.categoria,w=this.categorias.find(b=>b.id===_);return w?w.nombre:"\u2014"}getSubcategoriasFiltradas(){return this.subcategorias.filter(t=>!this.categoriaSeleccionada||t.categoria===this.categoriaSeleccionada)}getProductosFiltradosPorNombre(){let t=this.productoBuscado.toLowerCase();return this.productosSinStock.filter(i=>i.nombre.toLowerCase().includes(t))}selectProducto(t){this.selectedStock.producto=t;let i=this.productosSinStock.find(e=>e.id===t);this.productoBuscado=i?.nombre||"",this.mostrarListaProductos=!1}filterStocks(){this.filteredStocks=this.stocks.filter(t=>{let i=this.productosConStock.find(P=>P.id===t.producto),e=typeof i?.subcategoria=="object"?i.subcategoria.id:i?.subcategoria,a=this.subcategorias.find(P=>P.id===e),_=typeof a?.categoria=="object"?a.categoria.id:a?.categoria,w=!this.categoriaSeleccionada||_===this.categoriaSeleccionada,b=!this.subcategoriaSeleccionada||a?.id===this.subcategoriaSeleccionada,Q=this.searchTerm.trim()===""||i?.nombre.toLowerCase().includes(this.searchTerm.toLowerCase());return w&&b&&Q}),this.currentPage=1}paginatedStocks(){let t=(this.currentPage-1)*this.itemsPerPage;return this.filteredStocks.slice(t,t+this.itemsPerPage)}totalPages(){return Math.ceil(this.filteredStocks.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}addStock(){this.selectedStock=this.getEmptyStock(),this.productoBuscado="",this.mostrarListaProductos=!0,this.showModal=!0,this.loadProductosSinStock()}closeModal(){this.showModal=!1,this.selectedStock=this.getEmptyStock(),this.productoBuscado="",this.mostrarListaProductos=!0}saveStock(){let i=this.http.post("http://137.184.94.190/api/stock/",this.selectedStock);this.isSaving=!0,i.subscribe({next:()=>{y.default.fire("Guardado","Stock registrado correctamente.","success"),this.loadStocks(),this.closeModal(),this.isSaving=!1},error:e=>{this.isSaving=!1;let a=this.formatErrors(e?.error);y.default.fire("Error al guardar",a,"error")}})}handleHttpError(t){console.error("HTTP Error:",t);let i=this.formatErrors(t?.error);y.default.fire("Error",i,"error")}formatErrors(t){return!t||typeof t!="object"?"Error desconocido":Object.entries(t).map(([i,e])=>Array.isArray(e)?`<strong>${i}:</strong> ${e.join(", ")}`:e&&typeof e=="object"?`<strong>${i}:</strong><br>`+Object.entries(e).map(([a,_])=>`&nbsp;&nbsp;\u2192 ${a}: ${_}`).join("<br>"):`<strong>${i}:</strong> ${JSON.stringify(e)}`).join("<br>")}static{this.\u0275fac=function(i){return new(i||s)(O(A))}}static{this.\u0275cmp=M({type:s,selectors:[["app-stock"]],standalone:!0,features:[L],decls:2,vars:2,consts:[["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4","mb-6"],[1,"flex","flex-wrap","items-center","gap-3"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"inline-flex"],[1,"px-3","py-2","border","rounded-lg","bg-gray-100","text-black","w-auto","max-w-fit",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"w-full","sm:w-auto"],["type","text","placeholder","Buscar producto...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white"],[1,"p-3"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"hover:bg-gray-50","border-b"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","w-full","max-w-lg","p-6","rounded-xl","shadow-xl","relative","overflow-y-auto","max-h-[90vh]"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"bg-yellow-100","border-l-4","border-yellow-500","text-yellow-800","p-4","rounded-lg","mb-4","shadow-md"],[1,"font-semibold"],[1,"block","font-bold","mb-1"],["type","text","placeholder","Buscar producto...",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","input","ngModel"],["class","bg-white border border-gray-300 rounded-md shadow max-h-40 overflow-y-auto mt-1 text-black z-10 relative",4,"ngIf"],["type","number",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[1,"mt-6","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-xl",4,"ngIf"],[1,"bg-white","border","border-gray-300","rounded-md","shadow","max-h-40","overflow-y-auto","mt-1","text-black","z-10","relative"],["class","px-3 py-2 hover:bg-purple-100 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"px-3","py-2","hover:bg-purple-100","cursor-pointer",3,"click"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(i,e){i&1&&h(0,Y,2,0,"div",0)(1,at,47,13,"div",1),i&2&&(p("ngIf",e.isLoading),c(),p("ngIf",!e.isLoading))},dependencies:[W,F,B,N,K,$,J,z,R,q,H,G],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return s})();export{gt as StockComponent};
