import{b as H,c as z,f as G,i as q,j as J,k as R,m as $}from"./chunk-5TRB5RNR.js";import{a as U}from"./chunk-IL2UONYL.js";import{c as A}from"./chunk-C5J56EWV.js";import{$a as n,Ab as j,Ka as s,La as D,Va as C,Ya as m,_a as F,a as S,ab as i,bb as w,cc as W,dc as L,e as Q,eb as b,ec as B,fa as P,fb as g,gb as d,gc as N,lb as T,mb as r,nb as v,oa as c,ob as y,pa as p,pb as O,qa as V,ra as k,rb as _,sb as x,tb as f,vb as I,yb as E,zb as M}from"./chunk-RI4DZ32I.js";var h=Q(U());function X(l,u){l&1&&(n(0,"div",3),w(1,"div",4),i())}function Y(l,u){if(l&1){let e=b();n(0,"tr",25)(1,"td",26),r(2),i(),n(3,"td",19),r(4),i(),n(5,"td",19),r(6),E(7,"date"),i(),n(8,"td",19),r(9),E(10,"date"),i(),n(11,"td",19)(12,"span"),r(13),i()(),n(14,"td",27)(15,"button",28),g("click",function(){let t=c(e).$implicit,o=d(3);return p(o.showEditModal(t))}),r(16," \u270F\uFE0F "),n(17,"span"),r(18,"Editar"),i()(),n(19,"button",29),g("click",function(){let t=c(e).$implicit,o=d(3);return p(o.deleteCampana(t.id))}),r(20," \u{1F5D1}\uFE0F "),n(21,"span"),r(22,"Eliminar"),i()()()()}if(l&2){let e=u.$implicit;s(2),v(e.nombre),s(2),v(e.descripcion||"\u2014"),s(2),v(M(7,7,e.fecha_inicio,"short")),s(3),v(M(10,10,e.fecha_fin,"short")),s(3),F("px-2 py-1 rounded-full text-xs font-bold "+(e.activa?"bg-green-100 text-green-800":"bg-red-100 text-red-800")),s(),y(" ",e.activa?"S\xED":"No"," ")}}function Z(l,u){if(l&1){let e=b();n(0,"div")(1,"div",16)(2,"table",17)(3,"thead",18)(4,"tr")(5,"th",19),r(6,"Nombre"),i(),n(7,"th",19),r(8,"Descripci\xF3n"),i(),n(9,"th",19),r(10,"Inicio"),i(),n(11,"th",19),r(12,"Fin"),i(),n(13,"th",19),r(14,"Activo"),i(),n(15,"th",20),r(16,"Acciones"),i()()(),n(17,"tbody"),C(18,Y,23,13,"tr",21),i()()(),n(19,"div",22)(20,"button",23),g("click",function(){c(e);let t=d(2);return p(t.prevPage())}),r(21,"Anterior"),i(),n(22,"span",24),r(23),i(),n(24,"button",23),g("click",function(){c(e);let t=d(2);return p(t.nextPage())}),r(25,"Siguiente"),i()()()}if(l&2){let e=d(2);s(18),m("ngForOf",e.paginatedCampanas()),s(2),m("disabled",e.currentPage===1),s(3),O("P\xE1gina ",e.currentPage," de ",e.totalPages(),""),s(),m("disabled",e.currentPage===e.totalPages())}}function ee(l,u){l&1&&(n(0,"div",30)(1,"p",31),r(2,"\u{1F615} No hay campa\xF1as registradas."),i()())}function te(l,u){l&1&&(n(0,"div",46),w(1,"div",47),i())}function ne(l,u){if(l&1){let e=b();n(0,"div",32)(1,"div",33)(2,"h2",34),r(3),i(),n(4,"div",35)(5,"label",36),r(6,"\u{1F3F7}\uFE0F Nombre"),i(),n(7,"input",37),f("ngModelChange",function(t){c(e);let o=d(2);return x(o.selectedCampana.nombre,t)||(o.selectedCampana.nombre=t),p(t)}),i(),n(8,"label",36),r(9,"\u{1F4DD} Descripci\xF3n"),i(),n(10,"textarea",38),f("ngModelChange",function(t){c(e);let o=d(2);return x(o.selectedCampana.descripcion,t)||(o.selectedCampana.descripcion=t),p(t)}),i(),n(11,"label",36),r(12,"\u{1F4C5} Fecha de Inicio"),i(),n(13,"input",39),f("ngModelChange",function(t){c(e);let o=d(2);return x(o.selectedCampana.fecha_inicio,t)||(o.selectedCampana.fecha_inicio=t),p(t)}),i(),n(14,"label",36),r(15,"\u{1F4C5} Fecha de Fin"),i(),n(16,"input",39),f("ngModelChange",function(t){c(e);let o=d(2);return x(o.selectedCampana.fecha_fin,t)||(o.selectedCampana.fecha_fin=t),p(t)}),i(),n(17,"label",36),r(18,"\u{1F7E2} Activo"),i(),n(19,"select",40),f("ngModelChange",function(t){c(e);let o=d(2);return x(o.selectedCampana.activa,t)||(o.selectedCampana.activa=t),p(t)}),n(20,"option",41),r(21,"S\xED"),i(),n(22,"option",41),r(23,"No"),i()()(),n(24,"div",42)(25,"button",43),g("click",function(){c(e);let t=d(2);return p(t.saveCampana())}),r(26," \u2705 Guardar "),i(),n(27,"button",44),g("click",function(){c(e);let t=d(2);return p(t.closeModal())}),r(28," \u274C Cancelar "),i()(),C(29,te,2,0,"div",45),i()()}if(l&2){let e=d(2);s(3),y(" ",e.isEditMode?"\u270F\uFE0F Editar Campa\xF1a":"\u{1F3AF} Crear Campa\xF1a"," "),s(4),_("ngModel",e.selectedCampana.nombre),s(3),_("ngModel",e.selectedCampana.descripcion),s(3),_("ngModel",e.selectedCampana.fecha_inicio),s(3),_("ngModel",e.selectedCampana.fecha_fin),s(3),_("ngModel",e.selectedCampana.activa),s(),m("ngValue",!0),s(2),m("ngValue",!1),s(7),m("ngIf",e.isSaving)}}function ie(l,u){if(l&1){let e=b();n(0,"div",5)(1,"h1",6),r(2,"Gestionar Campa\xF1as"),i(),n(3,"div",7)(4,"div",8)(5,"button",9),g("click",function(){c(e);let t=d();return p(t.showAddModal())}),V(),n(6,"svg",10),w(7,"path",11),i(),r(8," Crear Campa\xF1a "),i()(),k(),n(9,"div",12)(10,"input",13),f("ngModelChange",function(t){c(e);let o=d();return x(o.searchTerm,t)||(o.searchTerm=t),p(t)}),g("ngModelChange",function(){c(e);let t=d();return p(t.filterCampanas())}),i()()(),C(11,Z,26,5,"div",14)(12,ee,3,0,"ng-template",null,0,j)(14,ne,30,9,"div",15),i()}if(l&2){let e=T(13),a=d();s(10),_("ngModel",a.searchTerm),s(),m("ngIf",a.filteredCampanas.length>0)("ngIfElse",e),s(3),m("ngIf",a.showModal)}}var ce=(()=>{class l{constructor(e){this.http=e,this.campanas=[],this.selectedCampana=this.getEmptyCampana(),this.showModal=!1,this.isEditMode=!1,this.isLoading=!1,this.isSaving=!1,this.searchTerm="",this.currentPage=1,this.itemsPerPage=5,this.filteredCampanas=[]}ngOnInit(){this.loadCampanas()}getEmptyCampana(){return{id:0,nombre:"",descripcion:"",fecha_inicio:"",fecha_fin:"",activa:!0}}loadCampanas(){this.isLoading=!0,this.http.get("http://137.184.94.190/api/campanas/").subscribe({next:e=>{this.campanas=e,this.filterCampanas(),this.isLoading=!1},error:e=>{this.isLoading=!1,this.handleHttpError(e)}})}showAddModal(){this.selectedCampana=this.getEmptyCampana(),this.isEditMode=!1,this.showModal=!0}showEditModal(e){this.selectedCampana=S({},e),this.isEditMode=!0,this.showModal=!0}closeModal(){this.selectedCampana=this.getEmptyCampana(),this.showModal=!1,this.isEditMode=!1}saveCampana(){console.log("Payload enviado:",this.selectedCampana);let e=this.isEditMode?`http://137.184.94.190/api/campanas/${this.selectedCampana.id}/`:"http://137.184.94.190/api/campanas/",a=this.isEditMode?this.http.put(e,this.selectedCampana):this.http.post(e,this.selectedCampana);this.isSaving=!0,a.subscribe({next:()=>{h.default.fire("\xC9xito",`Campa\xF1a ${this.isEditMode?"actualizada":"creada"} correctamente.`,"success"),this.loadCampanas(),this.closeModal(),this.isSaving=!1},error:t=>{this.isSaving=!1;let o=this.formatErrors(t?.error);h.default.fire("Error al guardar",o,"error")}})}deleteCampana(e){h.default.fire({title:"\xBFEliminar campa\xF1a?",text:"Esta acci\xF3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar"}).then(a=>{a.isConfirmed&&this.http.delete(`http://137.184.94.190/api/campanas/${e}/`).subscribe({next:()=>{h.default.fire("Eliminado","La campa\xF1a fue eliminada.","success"),this.loadCampanas()},error:t=>this.handleHttpError(t)})})}filterCampanas(){this.filteredCampanas=this.campanas.filter(e=>e.nombre.toLowerCase().includes(this.searchTerm.toLowerCase())),this.currentPage=1}paginatedCampanas(){let e=(this.currentPage-1)*this.itemsPerPage;return this.filteredCampanas.slice(e,e+this.itemsPerPage)}totalPages(){return Math.ceil(this.filteredCampanas.length/this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages()&&this.currentPage++}prevPage(){this.currentPage>1&&this.currentPage--}handleHttpError(e){console.error("HTTP Error:",e);let a=this.formatErrors(e?.error);h.default.fire("Error",a,"error")}formatErrors(e){return!e||typeof e!="object"?"Error desconocido":Object.entries(e).map(([a,t])=>Array.isArray(t)?`<strong>${a}:</strong> ${t.join(", ")}`:t&&typeof t=="object"?`<strong>${a}:</strong><br>`+Object.entries(t).map(([o,K])=>`&nbsp;&nbsp;\u2192 ${o}: ${K}`).join("<br>"):`<strong>${a}:</strong> ${JSON.stringify(t)}`).join("<br>")}static{this.\u0275fac=function(a){return new(a||l)(D(A))}}static{this.\u0275cmp=P({type:l,selectors:[["app-campanas"]],standalone:!0,features:[I],decls:2,vars:2,consts:[["noData",""],["class","spinner-container",4,"ngIf"],["class","container mx-auto px-4 py-8",4,"ngIf"],[1,"spinner-container"],[1,"spinner"],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4","mb-6"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-2","bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded-lg","shadow-md","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","white","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"w-full","sm:w-auto"],["type","text","placeholder","Buscar campa\xF1a...",1,"w-full","sm:w-72","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:border-purple-500",3,"ngModelChange","ngModel"],[4,"ngIf","ngIfElse"],["class","fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center",4,"ngIf"],[1,"overflow-x-auto"],[1,"min-w-full","bg-white","rounded-lg","shadow","text-sm"],[1,"bg-gray-800","text-white"],[1,"p-3"],[1,"p-3","text-center"],["class","hover:bg-gray-50 border-b",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","items-center","gap-2"],[1,"px-3","py-1","rounded","bg-gray-200","hover:bg-gray-300","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","font-medium","text-gray-700"],[1,"hover:bg-gray-50","border-b"],[1,"p-3","font-medium"],[1,"p-3","text-center","flex","gap-2","justify-center"],["title","Editar",1,"text-blue-600","hover:text-blue-800","flex","items-center","gap-1",3,"click"],["title","Eliminar",1,"text-red-600","hover:text-red-800","flex","items-center","gap-1",3,"click"],[1,"text-center","text-gray-500","mt-10"],[1,"text-lg"],[1,"fixed","inset-0","z-50","bg-black","bg-opacity-50","flex","items-center","justify-center"],[1,"bg-white","w-full","max-w-lg","p-6","rounded-xl","shadow-xl","relative","overflow-y-auto","max-h-[90vh]"],[1,"text-2xl","font-bold","mb-6","text-center","text-purple-600"],[1,"space-y-4"],[1,"block","font-bold","mb-1"],["type","text",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],["rows","3",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100","text-black",3,"ngModelChange","ngModel"],["type","datetime-local",1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","rounded-lg","bg-gray-100",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"mt-6","flex","justify-between"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-6","py-2","rounded-lg","shadow",3,"click"],["class","absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-xl",4,"ngIf"],[1,"absolute","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","rounded-xl"],[1,"w-12","h-12","border-4","border-white","border-t-purple-500","rounded-full","animate-spin"]],template:function(a,t){a&1&&C(0,X,2,0,"div",1)(1,ie,15,4,"div",2),a&2&&(m("ngIf",t.isLoading),s(),m("ngIf",!t.isLoading))},dependencies:[N,W,L,B,$,J,R,H,q,z,G],styles:[".spinner-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000c;display:flex;justify-content:center;align-items:center;z-index:1000}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid #ffffff;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #dee2e6;padding:12px;text-align:left}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f8f9fa}input[type=text][_ngcontent-%COMP%], input[type=file][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}button[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{opacity:.9}@media (max-width: 768px){table[_ngcontent-%COMP%]{font-size:14px}button[_ngcontent-%COMP%]{width:100%;margin-top:10px}}"]})}}return l})();export{ce as CampanasComponent};
