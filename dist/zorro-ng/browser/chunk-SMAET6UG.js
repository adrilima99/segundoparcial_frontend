import{b as W,c as L,f as B,i as V,j as N,k as O,m as q}from"./chunk-5TRB5RNR.js";import{a as j}from"./chunk-IL2UONYL.js";import{b as R,c as T}from"./chunk-C5J56EWV.js";import{$a as o,Ka as r,La as D,Va as f,Ya as p,ab as n,bb as x,cc as k,dc as E,e as A,eb as M,fa as v,fb as h,gb as _,gc as F,mb as a,nb as C,oa as I,ob as y,pa as S,rb as u,sb as c,tb as g,vb as P}from"./chunk-RI4DZ32I.js";var w=A(j());function z(s,m){if(s&1&&(o(0,"option",8),a(1),n()),s&2){let t=m.$implicit;p("ngValue",t.id),r(),C(t.nombre)}}function G(s,m){if(s&1&&(o(0,"option",8),a(1),n()),s&2){let t=m.$implicit;p("ngValue",t.id),r(),C(t.nombre)}}function H(s,m){if(s&1){let t=M();o(0,"li",22),h("click",function(){let e=I(t).$implicit,d=_(2);return S(d.seleccionarProducto(e))}),a(1),n()}if(s&2){let t=m.$implicit;r(),y(" ",t.nombre," ")}}function U(s,m){if(s&1&&(o(0,"ul",20),f(1,H,2,1,"li",21),n()),s&2){let t=_();r(),p("ngForOf",t.productosFiltrados)}}var ee=(()=>{class s{constructor(t){this.http=t,this.fechaInicio=null,this.fechaFin=null,this.categoriaId=null,this.subcategoriaId=null,this.productoId=null,this.tipo=null,this.formato="pdf",this.categorias=[],this.subcategorias=[],this.productos=[],this.productosFiltrados=[],this.busquedaProducto="",this.mostrarDropdown=!1,this.isLoading=!1,this.totalItems=0,this.currentPage=1,this.hasNextPage=!1,this.hasPrevPage=!1}ngOnInit(){this.cargarFiltros(),this.loadProductos()}cargarFiltros(){this.http.get("http://137.184.94.190/api/categorias/").subscribe(t=>this.categorias=t)}loadProductos(t=1){this.isLoading=!0,this.http.get(`http://137.184.94.190/api/productos/?sin_stock=all&page=${t}`).subscribe({next:l=>{this.productos=l.results,this.productosFiltrados=l.results,this.totalItems=l.count,this.hasNextPage=!!l.next,this.hasPrevPage=!!l.previous,this.currentPage=t,this.isLoading=!1},error:l=>{this.isLoading=!1,w.default.fire("Error","No se pudieron cargar los productos.","error"),console.error(l)}})}onCategoriaChange(){this.subcategoriaId=null,this.subcategorias=[],this.categoriaId&&this.http.get(`http://137.184.94.190/api/subcategorias/?categoria=${this.categoriaId}`).subscribe(t=>this.subcategorias=t)}onSubcategoriaChange(){this.filtrarProductosPorBusqueda()}onBuscarProductoChange(){this.filtrarProductosPorBusqueda(),this.mostrarDropdown=!0}seleccionarProducto(t){this.productoId=t.id,this.busquedaProducto=t.nombre,this.mostrarDropdown=!1}filtrarProductosPorBusqueda(){let t=this.busquedaProducto.toLowerCase();this.productosFiltrados=this.productos.filter(l=>l.nombre.toLowerCase().includes(t)&&(!this.subcategoriaId||l.subcategoria_id===this.subcategoriaId))}generarReporte(){let t=new R().set("fecha_inicio",this.fechaInicio||"").set("fecha_fin",this.fechaFin||"").set("categoria",this.categoriaId?.toString()||"").set("subcategoria",this.subcategoriaId?.toString()||"").set("producto",this.productoId?.toString()||"").set("tipo",this.tipo||""),l=this.formato==="pdf"?"http://137.184.94.190/api/reportes/inventario/pdf/":"http://137.184.94.190/api/reportes/inventario/excel/";this.isLoading=!0,this.http.get(l,{params:t,responseType:"blob"}).subscribe({next:e=>{let d=new Blob([e],{type:this.formato==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(d),b=document.createElement("a");b.href=i,b.download=this.formato==="pdf"?"reporte_inventario.pdf":"reporte_inventario.xlsx",b.click(),this.isLoading=!1},error:e=>{this.isLoading=!1,w.default.fire("Error","No se pudo generar el reporte.","error"),console.error(e)}})}static{this.\u0275fac=function(l){return new(l||s)(D(T))}}static{this.\u0275cmp=v({type:s,selectors:[["app-reportes-inventario"]],standalone:!0,features:[P],decls:53,vars:16,consts:[[1,"min-h-screen","bg-gradient-to-br","from-gray-100","via-white","to-purple-100","dark:from-gray-900","dark:via-gray-800","dark:to-purple-950","p-6","text-gray-900","dark:text-white"],[1,"container","mx-auto"],[1,"text-3xl","font-bold","mb-6","flex","items-center","gap-2"],["src","https://img.icons8.com/external-flatart-icons-outline-flatarticons/64/external-warehouse-logistics-flatart-icons-outline-flatarticons.png",1,"w-8","h-8"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mb-6"],[1,"block","font-semibold","mb-1"],["type","date",1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","change","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","change","ngModel","disabled"],[1,"relative"],["type","text","placeholder","Buscar producto...",1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","input","ngModel"],["class","absolute z-10 w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg mt-1 max-h-48 overflow-auto border border-gray-300 dark:border-gray-700",4,"ngIf"],[1,"w-full","px-4","py-2","rounded-lg","bg-white","text-black","dark:bg-gray-700","dark:text-white",3,"ngModelChange","ngModel"],["value","entrada"],["value","salida"],["value","pdf"],["value","excel"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-3","rounded-lg","shadow","font-bold","transition",3,"click","disabled"],[1,"absolute","z-10","w-full","bg-white","dark:bg-gray-800","shadow-lg","rounded-lg","mt-1","max-h-48","overflow-auto","border","border-gray-300","dark:border-gray-700"],["class","px-4 py-2 hover:bg-purple-100 dark:hover:bg-purple-800 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"px-4","py-2","hover:bg-purple-100","dark:hover:bg-purple-800","cursor-pointer",3,"click"]],template:function(l,e){l&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),x(3,"img",3),a(4," Reporte de Inventario "),n(),o(5,"div",4)(6,"div")(7,"label",5),a(8,"\u{1F4C5} Fecha Inicio"),n(),o(9,"input",6),g("ngModelChange",function(i){return c(e.fechaInicio,i)||(e.fechaInicio=i),i}),n()(),o(10,"div")(11,"label",5),a(12,"\u{1F4C5} Fecha Fin"),n(),o(13,"input",6),g("ngModelChange",function(i){return c(e.fechaFin,i)||(e.fechaFin=i),i}),n()(),o(14,"div")(15,"label",5),a(16,"\u{1F4C1} Categor\xEDa"),n(),o(17,"select",7),g("ngModelChange",function(i){return c(e.categoriaId,i)||(e.categoriaId=i),i}),h("change",function(){return e.onCategoriaChange()}),o(18,"option",8),a(19,"Todas"),n(),f(20,z,2,2,"option",9),n()(),o(21,"div")(22,"label",5),a(23,"\u{1F4C2} Subcategor\xEDa"),n(),o(24,"select",10),g("ngModelChange",function(i){return c(e.subcategoriaId,i)||(e.subcategoriaId=i),i}),h("change",function(){return e.onSubcategoriaChange()}),o(25,"option",8),a(26,"Todas"),n(),f(27,G,2,2,"option",9),n()(),o(28,"div",11)(29,"label",5),a(30,"\u{1F4E6} Producto"),n(),o(31,"input",12),g("ngModelChange",function(i){return c(e.busquedaProducto,i)||(e.busquedaProducto=i),i}),h("input",function(){return e.onBuscarProductoChange()}),n(),f(32,U,2,1,"ul",13),n(),o(33,"div")(34,"label",5),a(35,"\u{1F504} Tipo Movimiento"),n(),o(36,"select",14),g("ngModelChange",function(i){return c(e.tipo,i)||(e.tipo=i),i}),o(37,"option",8),a(38,"Todos"),n(),o(39,"option",15),a(40,"Entrada"),n(),o(41,"option",16),a(42,"Salida"),n()()(),o(43,"div")(44,"label",5),a(45,"\u{1F4C2} Formato"),n(),o(46,"select",14),g("ngModelChange",function(i){return c(e.formato,i)||(e.formato=i),i}),o(47,"option",17),a(48,"\u{1F4C4} PDF"),n(),o(49,"option",18),a(50,"\u{1F4CA} Excel"),n()()()(),o(51,"button",19),h("click",function(){return e.generarReporte()}),a(52),n()()()),l&2&&(r(9),u("ngModel",e.fechaInicio),r(4),u("ngModel",e.fechaFin),r(4),u("ngModel",e.categoriaId),r(),p("ngValue",null),r(2),p("ngForOf",e.categorias),r(4),u("ngModel",e.subcategoriaId),p("disabled",!e.categoriaId||e.subcategorias.length===0),r(),p("ngValue",null),r(2),p("ngForOf",e.subcategorias),r(4),u("ngModel",e.busquedaProducto),r(),p("ngIf",e.mostrarDropdown&&e.productosFiltrados.length>0),r(4),u("ngModel",e.tipo),r(),p("ngValue",null),r(9),u("ngModel",e.formato),r(5),p("disabled",e.isLoading),r(),y(" \u{1F4E5} ",e.isLoading?"Generando...":"Generar Reporte"," "))},dependencies:[F,k,E,q,N,O,W,V,L,B]})}}return s})();export{ee as ReportesInventarioComponent};
